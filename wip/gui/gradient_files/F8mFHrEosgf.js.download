if (self.CavalryLogger) { CavalryLogger.start_js(["RHBp\/"]); }

__d("SpotlightViewerLoggingEvents",[],(function a(b,c,d,e,f,g){f.exports={LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"};}),null);
__d('PhotoViewerDimensions',['Event','PhotoUtils','Vector'],(function a(b,c,d,e,f,g){var h={verticalPadding:'number',horizontalPadding:'number',normalResDim:'object'};function i(j){'use strict';this._verticalPadding=40;this._horizontalPadding=60;this._normalResDim={x:960,y:960};this._photoStripHeight=88;for(var k in j){if(!h[k])throw new Error("Unsupported extraData value '"+k+"' should not be used");if(typeof j[k]===h[k])this['_'+k]=j[k];}this._listener=c('Event').listen(window,'resize',this._resetMaxStageDimensions.bind(this));}i.prototype.destroy=function(){'use strict';this._listener.remove();};i.prototype.getStageDimensions=function(j){'use strict';var k=this.getMaxStageDimensions(),l=new (c('Vector'))(Math.min(j.x,k.x),Math.min(j.y,k.y)),m=l.x/l.y,n=j.x/j.y;if(m<n){l.y=Math.round(l.x/n);}else l.x=Math.round(l.y*n);return l;};i.prototype.getImageDimensionsForStage=function(j,k){'use strict';var l=j.x,m=j.y,n=k.x,o=k.y;if(l>=n||m>=o){var p=l/m,q=n/o;if(q<p){l=n;m=Math.round(n/p);}else if(q>p){l=Math.round(o*p);m=o;}else{l=n;m=o;}}return new (c('Vector'))(l,m);};i.prototype.getImageDimensionsForMaxStage=function(j,k){'use strict';var l=j.x,m=j.y,n=k.x,o=k.y-this._photoStripHeight,p=l/m,q=n/o;if(l>=n||m>=o){if(q<p){l=n;m=Math.round(n/p);}else if(q>p){l=Math.round(o*p);m=o;}else{l=n;m=o;}}else if(p<q){l=Math.round(m*p);}else m=Math.round(l/p);return new (c('Vector'))(l,m);};i.prototype.getMaxStageDimensions=function(){'use strict';if(!this._maxStageDimensions)this._maxStageDimensions=new (c('Vector'))(c('Vector').getViewportDimensions().x-this._horizontalPadding,c('Vector').getViewportDimensions().y-this._verticalPadding);return this._maxStageDimensions;};i.prototype.getMaxStageDimensionsWithoutPadding=function(){'use strict';if(!this._maxStageDimensions)this._maxStageDimensions=new (c('Vector'))(c('Vector').getViewportDimensions().x,c('Vector').getViewportDimensions().y);return this._maxStageDimensions;};i.prototype._resetMaxStageDimensions=function(){'use strict';this._maxStageDimensions=null;};i.prototype.getBestFitImageFromPhoto=function(j,k){'use strict';var l=null,m=c('PhotoUtils').getImagesFromData(j);m=m.sort(function(o,p){return p.width-o.width;});if(window.devicePixelRatio&&window.devicePixelRatio>1)k=new (c('Vector'))(k.x*window.devicePixelRatio,k.y*window.devicePixelRatio);for(var n=0;n<m.length;n++)if(!l||m[n].width>=k.x||m[n].height>=k.y)l=m[n];return l;};i.prototype.getOriginalDimensionsFromPhoto=function(j){'use strict';var k=c('PhotoUtils').getOriginalImageFromData(j);return new (c('Vector'))(k.width,k.height);};i.prototype.getBestFitDimensionsFromPhoto=function(j,k){'use strict';var l=this.getBestFitImageFromPhoto(j,k);return new (c('Vector'))(l.width,l.height);};i.prototype.getVerticalPadding=function(){'use strict';return this._verticalPadding;};i.prototype.getHorizontalPadding=function(){'use strict';return this._horizontalPadding;};f.exports=i;}),null);
__d('SpotlightViewerBottomBar',['cx','LeftRight.react','React','joinClasses'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';var l=Array.isArray(this.props.children)?this.props.children:[this.props.children],m="_4_8n _51an";if(this.props.className)m=c('joinClasses')(m,this.props.className);if(l.length===1)return c('React').createElement('div',{className:m},l[0]);m=c('joinClasses')(m,"_50-m");return c('React').createElement(c('LeftRight.react'),{className:m},l[0],l[1]);};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerBottomBarGroup',['cx','React'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';var l=this.props.itemmargin||'right',m=(l=='left'?"marginLeft":'')+(l=='right'?' '+"marginRight":'')+(' '+"_4_8i");return c('React').createElement('div',{className:m},this.props.children);};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerClose',['cx','fbt','React','TooltipLink.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){'use strict';var n=this.props.position=='left'?"_5wx3":"_5wx4",o=c('React').createElement('span',null,i._("Press Esc to close"));return c('React').createElement(c('TooltipLink.react'),{className:c('joinClasses')("_4-o9 _50-m _51an",n),onClick:this.props.onClick,tooltip:o});};function m(){'use strict';j.apply(this,arguments);}m.propTypes={position:l.oneOf(['left','right'])};m.defaultProps={position:'right'};f.exports=m;}),null);
__d('MessagingVideoViewer.react',['cx','fbt','ActorURI','ArbiterMixin','AsyncRequest','MessagingForwardingButtonNUX.react','React','ReactFragment','SpotlightViewer','SpotlightViewerBottomBar','SpotlightViewerBottomBarGroup','SpotlightViewerBottomBarLink','SpotlightViewerClose','SpotlightViewport','PageTransitionsRegistrar','PhotoViewerDimensions','XMessagingVideoAttachmentController','Vector','guid'],(function a(b,c,d,e,f,g,h,i){var j=c('React').PropTypes,k=200,l=c('React').createClass({displayName:'MessagingVideoViewer',propTypes:{disableForward:j.bool,forwardDialogComponent:j.func.isRequired,pageID:j.number,rootClassName:j.string,videoSize:j.instanceOf(c('Vector')).isRequired,videoID:j.string.isRequired,videoURI:j.string.isRequired},mixins:[c('ArbiterMixin')],getInitialState:function m(){var n=new (c('PhotoViewerDimensions'))({verticalPadding:k});return {dimensions:n.getStageDimensions(this.props.videoSize),loading:true,open:true,showForward:false};},componentWillMount:function m(){this._domID=c('guid')();},componentDidMount:function m(){this._loadVideoPlayer();c('PageTransitionsRegistrar').registerCompletionCallback(function(){this.close();return true;}.bind(this));},_loadVideoPlayer:function m(){var n=c('XMessagingVideoAttachmentController').getURIBuilder().setString('video_id',this.props.videoID).setString('video_container_id',this._domID).setInt('width',this.state.dimensions.x).setInt('height',this.state.dimensions.y).getURI();if(this.props.pageID)n=c('ActorURI').create(n,this.props.pageID);this.request=new (c('AsyncRequest'))().setMethod('GET').setURI(n).setReadOnly(true).setHandler(function(o){return this.setState({loading:false});}.bind(this)).send();},close:function m(){if(!this.state.open)return;this.setState({open:false},function(){this.inform('close');});},_showForwardDialog:function m(){this.setState({showForward:true});this.refs.forwardNUX.close();},_hideForwardDialog:function m(){this.setState({showForward:false});},renderLayers:function m(){if(this.props.disableForward)return null;var n=i._("Forward in separate messages"),o=this.props.forwardDialogComponent;return c('ReactFragment').create({forwardDialog:c('React').createElement(o,{attachmentID:this.props.videoID,onClose:this._hideForwardDialog,shown:this.state.showForward,title:n}),forwardButtonNUX:c('React').createElement(c('MessagingForwardingButtonNUX.react'),{contextRef:function(){return this.refs.forwardButton;}.bind(this),ref:'forwardNUX'},i._("Send this video to other people in separate messages."))});},render:function m(){var n=c('React').createElement('div',{className:"rfloat",id:this._domID}),o;if(!this.props.disableForward)o=c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this._showForwardDialog,ref:'forwardButton'},i._("Forward"));return c('React').createElement('span',null,c('React').createElement(c('SpotlightViewer'),{onHide:this.close,open:this.state.open,rootClassName:this.props.rootClassName},c('React').createElement(c('SpotlightViewport'),{active:true,className:"_39hc",media:n,showLoadingIndicator:this.state.loading,stageDimensions:this.state.dimensions,useWidth:true},c('React').createElement(c('SpotlightViewerClose'),{onClick:this.close}),c('React').createElement(c('SpotlightViewerBottomBar'),{className:"stat_elem"},c('React').createElement(c('SpotlightViewerBottomBarGroup'),null),c('React').createElement(c('SpotlightViewerBottomBarGroup'),null,o,c('React').createElement(c('SpotlightViewerBottomBarLink'),{s:'true',href:this.props.videoURI},i._("Download")))))),this.renderLayers());}});f.exports=l;}),null);
__d('SpotlightViewerAutoResize',['invariant','Event','SubscriptionsHandler'],(function a(b,c,d,e,f,g,h){function i(j){'use strict';this.$SpotlightViewerAutoResize1=j;typeof this.$SpotlightViewerAutoResize1.onResize==='function'||h(0);}i.prototype.enable=function(){'use strict';this.$SpotlightViewerAutoResize2=new (c('SubscriptionsHandler'))();this.$SpotlightViewerAutoResize2.addSubscriptions(c('Event').listen(window,'resize',this.$SpotlightViewerAutoResize1.onResize));};i.prototype.disable=function(){'use strict';this.$SpotlightViewerAutoResize2.release();delete this.$SpotlightViewerAutoResize2;};f.exports=i;}),null);
__d('SpotlightViewerBehaviorsMixin',['BehaviorsMixin'],(function a(b,c,d,e,f,g){var h={componentWillMount:function i(){this.behaviors&&this.enableBehaviors(this.behaviors);},componentWillUnmount:function i(){this.destroyBehaviors();}};Object.assign(h,c('BehaviorsMixin'));f.exports=h;}),null);
__d('PhotoLogger',['Event','Banzai','BanzaiScuba','SpotlightViewerLoggingEvents','SubscriptionsHandler'],(function a(b,c,d,e,f,g){function h(i){'use strict';this.$PhotoLogger1=i;this.$PhotoLogger2={};}h.prototype.log=function(i,j,k,l){'use strict';c('Banzai').post('profile_photos_view',{photo_fbid:j,source:k,profile_id:l});if(!this.$PhotoLogger2[i]){this.$PhotoLogger3(i);this.$PhotoLogger2[i]=true;}};h.prototype.$PhotoLogger3=function(i){'use strict';this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').LOADING,{uri:i});var j=new (c('SubscriptionsHandler'))(),k=new Image();j.addSubscriptions(c('Event').listen(k,'load',function(){this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').LOADED,{uri:i});j.release();}.bind(this)),c('Event').listen(k,'error',function(){this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').ERROR,{uri:i});j.release();}.bind(this)),c('Event').listen(k,'abort',function(){this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').ABORT,{uri:i});j.release();}.bind(this)));k.src=i;};h.prototype.logEvent=function(i){'use strict';this.$PhotoLogger4(i);};h.prototype.$PhotoLogger4=function(i,j){'use strict';var k=new (c('BanzaiScuba'))('photos_client_loading',null,{addBrowserFields:true});k.addNormal('event',i);k.addNormal('viewer',this.$PhotoLogger1);for(var l in j)k.addNormal(l,j[l]);k.post();};f.exports=h;}),null);
__d('PhotoStoreCore',[],(function a(b,c,d,e,f,g){var h={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function i(j){if(!this._photoCache[j])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[j];},hasBeenCreated:function i(j){return !!this._photoCache[j];},clearSetCache:function i(j){delete this._photoCache[j];delete this._postCreateCallbacks[j];},getByIndex:function i(j,k,l){this.getPhotoCache(j).getItemAtIndex(k,l);},getByIndexImmediate:function i(j,k){if(this._photoCache[j])return this._photoCache[j].getItemAtIndexImmediate(k);return undefined;},getItemsInAvailableRange:function i(j){var k=this.getAvailableRange(j),l=[];for(var m=k.offset;m<k.length;m++)l.push(this.getByIndexImmediate(j,m));return l;},getItemsAfterIndex:function i(j,k,l,m){var n=this.getCursorByIndexImmediate(j,k);this.fetchForward(j,n,l,m);},getAllByIDImmediate:function i(j){var k=Object.keys(this._photoCache);return k.map(function(l){return this.getByIndexImmediate(l,this.getIndexForID(l,j));}.bind(this)).filter(function(l){return !!l;});},getIndexForID:function i(j,k){if(this._photoCache[j])return this._photoCache[j].getIndexForID(k);return undefined;},getEndIndex:function i(j){var k=this.getAvailableRange(j);return k.offset+k.length-1;},getCursorByIndexImmediate:function i(j,k){var l=this.getByIndexImmediate(j,k);if(l)return this._photoCache[j].getCursorForID(l.id);return undefined;},hasNextPage:function i(j){var k=this.getCursorByIndexImmediate(j,this.getEndIndex(j));return this.getPhotoCache(j).hasNextPage(k);},getAvailableRange:function i(j){return this.getPhotoCache(j).getAvailableRange();},hasLooped:function i(j){return this.getPhotoCache(j).hasLooped();},fetchForward:function i(j,k,l,m){this.getPhotoCache(j).getItemsAfterCursor(k,l,m);},fetchBackward:function i(j,k,l,m){this.getPhotoCache(j).getItemsBeforeCursor(k,l,m);},executePostCreate:function i(j,k){if(this._photoCache[j]){k&&k();}else this._postCreateCallbacks[j]=k;},runPostCreateCallback:function i(j){var k=this._postCreateCallbacks[j];if(k){k();delete this._postCreateCallbacks[j];}},setPreFetchCallback:function i(j,k){this.getPhotoCache(j).setPreFetchCallback(k);},updateData:function i(j){var k=j.set_id;if(!this._photoCache[k]){this._photoCache[k]=new j.cache_class(j);this.runPostCreateCallback(k);}else if(j.query_metadata.action==h.actions.UPDATE){this._photoCache[k].updateData(j);}else this._photoCache[k].addData(j);},updateFeedbackData:function i(j){var k=Object.keys(j);k.forEach(function(l){return h.getAllByIDImmediate(l).forEach(function(m){m.feedback=j[l].feedback;});});},reset:function i(){Object.keys(this._photoCache).forEach(function(j){return this.clearSetCache(j);}.bind(this));}};f.exports=h;}),null);
__d('PhotoStore',['Arbiter','PhotoStoreCore'],(function a(b,c,d,e,f,g){c('Arbiter').subscribe('update-photos',function(h,i){c('PhotoStoreCore').updateData(i);});f.exports=c('PhotoStoreCore');}),null);
__d('PhotoViewState',['ArbiterMixin','PhotoStore','PhotoUtils','SpotlightViewerLoggingEvents','mixin'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l,m){'use strict';i.constructor.call(this);var n=m||{};this._viewer=k;this._setID=l;this._position=n.position||0;this._preventPreload=n.preventPreload;this._reverse=n.reverse;this._updateCallback=n.updateCallback;this._preloaded={};}j.prototype._fetchCallback=function(k){'use strict';if(!this._viewer.isOpen())return;this._preload(k);this._log(c('SpotlightViewerLoggingEvents').DATA_FETCH_COMPLETE);};j.prototype._preload=function(k){'use strict';c('PhotoUtils').preload(this._viewer,k,function(l){this._preloaded[c('PhotoUtils').getFBIDFromData(l)]=true;}.bind(this));};j.prototype._preloadPhotosInRange=function(k,l){'use strict';var m=[];for(var n=k;n<=l;++n){var o=c('PhotoStore').getByIndexImmediate(this._setID,n);if(o&&!this._isPreloaded(o))m.push(o);}this._preload(m);};j.prototype._isPreloaded=function(k){'use strict';return this._preloaded[c('PhotoUtils').getFBIDFromData(k)];};j.prototype.getPosition=function(){'use strict';return this._position;};j.prototype.isValidMovement=function(k){'use strict';if(!c('PhotoStore').hasBeenCreated(this._setID))return false;if(c('PhotoStore').hasLooped(this._setID))return true;var l=this._position+k,m=c('PhotoStore').getAvailableRange(this._setID),n=m.offset+m.length-1;return l>=m.offset-1&&l<=n+1;};j.prototype.getRelativeMovement=function(k){'use strict';return c('PhotoStore').getIndexForID(this._setID,k)-this._position;};j.prototype.moveCursor=function(k){'use strict';if(!this.isValidMovement(k))return false;this._position+=k;return true;};j.prototype._page=function(k){'use strict';if(!this.moveCursor(k))return;this._log(c('SpotlightViewerLoggingEvents').PAGE_BEGIN);var l=c('PhotoStore').getByIndexImmediate(this._setID,this._position);if(!l){this.inform('photo_fetch');this._log(c('SpotlightViewerLoggingEvents').PHOTO_FETCH);}else if(!this._isPreloaded(l))this._preload([l]);c('PhotoStore').getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(k>0,j.BUFFER_SIZE);this._log(c('SpotlightViewerLoggingEvents').PAGE_COMPLETE);};j.prototype.loadMoreForwardIfNecessary=function(k){'use strict';if(this._preventPreload)return;var l=c('PhotoStore').getAvailableRange(this._setID),m=l.offset+l.length-1,n=this._position+k;if(n>m&&!c('PhotoStore').hasLooped(this._setID)){var o=c('PhotoStore').getCursorByIndexImmediate(this._setID,m);c('PhotoStore').fetchForward(this._setID,o,k,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,n);};j.prototype.loadMoreBackwardIfNecessary=function(k){'use strict';if(this._preventPreload)return;var l=c('PhotoStore').getAvailableRange(this._setID),m=this._position-k;if(m<l.offset&&!c('PhotoStore').hasLooped(this._setID)){var n=c('PhotoStore').getCursorByIndexImmediate(this._setID,l.offset);c('PhotoStore').fetchBackward(this._setID,n,k,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(m,this._position-1);};j.prototype._loadMoreIfNecessary=function(k,l){'use strict';if(k){this.loadMoreForwardIfNecessary(l);}else this.loadMoreBackwardIfNecessary(l);};j.prototype.displayFirst=function(){'use strict';if(!this._viewer.isOpen())return;c('PhotoStore').setPreFetchCallback(this._setID,function(){this._log(c('SpotlightViewerLoggingEvents').DATA_FETCH_BEGIN);}.bind(this));var k=function(l){if(!this._isPreloaded(l))this._preload([l]);this._updateCallback&&this._updateCallback(l);}.bind(this);c('PhotoStore').getByIndex(this._setID,this._position,k);if(this._reverse){this.loadMoreBackwardIfNecessary(j.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(j.BUFFER_SIZE);};j.prototype.backward=function(){'use strict';this._page(this._reverse?1:-1);};j.prototype.forward=function(){'use strict';this._page(this._reverse?-1:1);};j.prototype._log=function(k){'use strict';this._viewer.log(k);};Object.assign(j,{BUFFER_SIZE:4});f.exports=j;}),null);
__d('SpotlightViewerCoreMixin',['PhotoLogger','PhotoStore','PhotoUtils','PhotoViewState','React','SpotlightViewerImage','SpotlightViewerLoggingEvents'],(function a(b,c,d,e,f,g){var h={_displayFirstPhoto:function i(){c('PhotoStore').executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function i(){var j;if(!this.props.clearcache)j=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid);if(j===undefined){c('PhotoStore').clearSetCache(this.props.setid);j=0;}return j;},__displayPhoto:function i(){var j=this._getInitialPosition();this.viewState=new (c('PhotoViewState'))(this,this.props.setid,{position:j,preventPreload:this.__shouldPreventPhotoPreload,reverse:this.props.reverse,updateCallback:this._updatePhoto});this.inform('open');this._displayFirstPhoto();},componentWillMount:function i(){this._logger=new (c('PhotoLogger'))(this.getViewerID());this.log(c('SpotlightViewerLoggingEvents').OPEN_BEGIN);this.__displayPhoto();},componentDidMount:function i(){this._enableSubscriptions&&this._enableSubscriptions();this.log(c('SpotlightViewerLoggingEvents').OPEN_COMPLETE);},isOpen:function i(){return this.state.open;},close:function i(){if(!this.isOpen())return;this.log(c('SpotlightViewerLoggingEvents').CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(c('SpotlightViewerLoggingEvents').CLOSE_COMPLETE);});},componentWillUnmount:function i(){this.viewState=null;},_onClickViewport:function i(j){j?this.viewState.forward():this.viewState.backward();},_getMedia:function i(j,k){return c('React').createElement(c('SpotlightViewerImage'),{ref:'image',src:j.uri,dimensions:k.imageDimensions});},_getCurrentFBID:function i(){return c('PhotoUtils').getFBIDFromData(this.state.photoData);},_updatePhoto:function i(j){this.log(c('SpotlightViewerLoggingEvents').PHOTO_CHANGE_BEGIN);this.setState({photoData:j},function(){this.inform('photo_change',this.state.photoData);this.log(c('SpotlightViewerLoggingEvents').PHOTO_CHANGE_COMPLETE);});},getLogger:function i(){return this._logger;},log:function i(j){this._logger&&this._logger.logEvent(j);}};f.exports=h;}),null);
__d('SpotlightViewerStageResizer',['MessengerEnvironment','Event','SubscriptionsHandler','Vector'],(function a(b,c,d,e,f,g){var h=520;function i(j,k){'use strict';this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._subscriptionsHandler.addSubscriptions(c('Event').listen(window,'resize',this._resetStageDimensions.bind(this)));this._dimensions=j;this._minHeight=k.minHeight||h;this._minWidth=k.minWidth||h;this._resetStageDimensions();}i.prototype.destroy=function(){'use strict';this._dimensions=null;this._subscriptionsHandler.release();};i.prototype._resetStageDimensions=function(){'use strict';this._currentStageDimensions=new (c('Vector'))(this._minWidth,this._minHeight);};i.prototype.getImageAndStageDimensions=function(j){'use strict';var k=this._dimensions.getBestFitDimensionsFromPhoto(j,this._dimensions.getMaxStageDimensions()),l=c('MessengerEnvironment').messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding(k):this._dimensions.getStageDimensions(k);this._currentStageDimensions=new (c('Vector'))(Math.max(l.x,this._minWidth,this._currentStageDimensions.x),Math.max(l.y,this._minHeight,this._currentStageDimensions.y));var m=c('MessengerEnvironment').messengerui?this._dimensions.getImageDimensionsForMaxStage(k,this._currentStageDimensions):this._dimensions.getImageDimensionsForStage(k,this._currentStageDimensions);return {stageDimensions:this._currentStageDimensions,imageDimensions:m};};i.prototype.getCurrentStageDimensions=function(){'use strict';return this._currentStageDimensions;};f.exports=i;}),null);
__d('SpotlightViewerDimensionMixin',['MessengerEnvironment','SpotlightViewerStageResizer','PhotoViewerDimensions'],(function a(b,c,d,e,f,g){var h={getInitialState:function i(){this._dimensions=new (c('PhotoViewerDimensions'))({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new (c('SpotlightViewerStageResizer'))(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return {maxStageDimensions:c('MessengerEnvironment').messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions()};},componentWillUnmount:function i(){this._resizer&&this._resizer.destroy();this._resizer=null;this._dimensions&&this._dimensions.destroy();this._dimensions=null;},getMedia:function i(){if(this.state.photoData){if(this.state.photoData.__typename&&this.state.photoData.__typename==='MessageVideo')return this._getVideo();var j=this._resizer.getImageAndStageDimensions(this.state.photoData),k=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(k,j);}else return null;},getDimensions:function i(){return this._dimensions;},getStageDimensions:function i(){if(this.state.photoData){return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;}else return c('MessengerEnvironment').messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions();},getImageDimensions:function i(){if(!this.state.photoData)return null;return this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions;},onResize:function i(){if(c('MessengerEnvironment').messengerui){var j=this._dimensions.getMaxStageDimensionsWithoutPadding();this.setState({maxStageDimensions:j,width:j.x});}else this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});}};f.exports=h;}),null);
__d('SpotlightViewerPageWithKeys',['KeyEventController','SubscriptionsHandler'],(function a(b,c,d,e,f,g){function h(i){'use strict';this.$SpotlightViewerPageWithKeys1=i;}h.prototype.enable=function(){'use strict';this.$SpotlightViewerPageWithKeys2=new (c('SubscriptionsHandler'))();this.$SpotlightViewerPageWithKeys2.addSubscriptions(c('KeyEventController').registerKey('LEFT',function(){this.$SpotlightViewerPageWithKeys1.viewState.backward();return false;}.bind(this)),c('KeyEventController').registerKey('RIGHT',function(){this.$SpotlightViewerPageWithKeys1.viewState.forward();return false;}.bind(this)));};h.prototype.disable=function(){'use strict';this.$SpotlightViewerPageWithKeys2.release();delete this.$SpotlightViewerPageWithKeys2;};f.exports=h;}),null);
__d('SpotlightViewerPagers',['cx','LeftRight.react','Link.react','React'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';return c('React').createElement(c('LeftRight.react'),null,c('React').createElement(c('Link.react'),{className:"_4-oa _4-ob _50-m"}),c('React').createElement(c('Link.react'),{className:"_4-oa _4-oc _50-m"}));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerThumbnailMixin',['PhotoStore','Vector'],(function a(b,c,d,e,f,g){var h={_getInitialPhotoData:function i(){var j=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid),k=c('PhotoStore').getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function i(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=c('Vector').deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};f.exports=h;}),null);
__d('SpotlightMessagesViewer',['fbt','ActorURI','ArbiterMixin','MessagingForwardingButtonNUX.react','PageTransitionsRegistrar','React','ReactFragment','SpotlightViewer','SpotlightViewerAutoResize','SpotlightViewerBehaviorsMixin','SpotlightViewerBottomBar','SpotlightViewerBottomBarGroup','SpotlightViewerBottomBarLink','SpotlightViewerClose','SpotlightViewerCoreMixin','SpotlightViewerDimensionMixin','SpotlightViewerPagers','SpotlightViewerPageWithKeys','SpotlightViewerThumbnailMixin','SpotlightViewport','SubscriptionsHandler','XMessagingPhotoDownloadController'],(function a(b,c,d,e,f,g,h){var i=c('React').createClass({displayName:'SpotlightMessagesViewer',mixins:[c('ArbiterMixin'),c('SpotlightViewerBehaviorsMixin'),c('SpotlightViewerCoreMixin'),c('SpotlightViewerThumbnailMixin'),c('SpotlightViewerDimensionMixin')],behaviors:[c('SpotlightViewerPageWithKeys'),c('SpotlightViewerAutoResize')],componentWillUnmount:function j(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getViewerID:function j(){return this.props.setid;},getInitialState:function j(){this._subscriptions=new (c('SubscriptionsHandler'))();return {photoData:this._getInitialPhotoData(),open:true,showForward:false};},_enableSubscriptions:function j(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',function(){return this.setState({photoData:null});}.bind(this)));},_showForwardDialog:function j(){this.setState({showForward:true});this.refs.forwardNUX.close();},_hideForwardDialog:function j(){this.setState({showForward:false});},renderLayers:function j(){if(this.props.disableForward)return null;var k=h._("Forward in separate messages"),l=this.props.forwardDialogComponent;return c('ReactFragment').create({forwardDialog:c('React').createElement(l,{attachmentID:String(this.state.photoData.id),onClose:this._hideForwardDialog,shown:this.state.showForward,title:k}),forwardButtonNUX:c('React').createElement(c('MessagingForwardingButtonNUX.react'),{contextRef:function(){return this.refs.forwardButton;}.bind(this),ref:'forwardNUX'},h._("Send this image to other people in separate messages."))});},render:function j(){var k=this.getMedia(),l=this.props.snapToPhoto?this.getImageDimensions():this.getStageDimensions();l.x=Math.max(l.x,185);l.y=Math.max(l.y,185);var m=this.props.useloadingindicator&&!this.state.photoData;c('PageTransitionsRegistrar').registerCompletionCallback(function(){if(this.state.open)this.close();return true;}.bind(this));return c('React').createElement('span',null,c('React').createElement(c('SpotlightViewer'),{rootClassName:this.props.rootClassName,open:this.state.open,onHide:this.close},c('React').createElement(c('SpotlightViewport'),{active:false,onClick:this._onClickViewport,stageDimensions:l,media:k,showLoadingIndicator:m,useWidth:true},c('React').createElement(c('SpotlightViewerClose'),{onClick:this.close}),this.props.disablepaging?null:c('React').createElement(c('SpotlightViewerPagers'),null),this._renderBottomBar())),this.renderLayers());},_renderBottomBar:function j(){var k;if(!this.props.disableForward)k=c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this._showForwardDialog,ref:'forwardButton'},h._("Forward"));var l=c('XMessagingPhotoDownloadController').getURIBuilder().setString('photo_id',String(this.state.photoData.id)).getURI();if(this.props.actorid)l=c('ActorURI').create(l,this.props.actorid);return c('React').createElement(c('SpotlightViewerBottomBar'),null,c('React').createElement(c('SpotlightViewerBottomBarGroup'),null),c('React').createElement(c('SpotlightViewerBottomBarGroup'),null,k,c('React').createElement(c('SpotlightViewerBottomBarLink'),{rel:'async',ajaxify:l},h._("Download"))));}});f.exports=i;}),null);