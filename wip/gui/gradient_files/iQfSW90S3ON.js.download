if (self.CavalryLogger) { CavalryLogger.start_js(["sDG3R"]); }

__d("RTCCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={INCOMING_CALL_SUCCESS:"INCOMING_CALL_SUCCESS",RESET:"RESET",REMOTE_VIDEO_MUTED:"REMOTE_VIDEO_MUTED",REMOTE_VIDEO_UNMUTED:"REMOTE_VIDEO_UNMUTED"};}),null);
__d("RTCGroupCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={CALL:"CALL",CALL_SUCCESS:"CALL_SUCCESS",CALL_ERROR:"CALL_ERROR",INIT:"INIT",WAIT_FOR_USER_INPUT:"WAIT_FOR_USER_INPUT",SET_CALL_SUMMARY:"SET_CALL_SUMMARY",SET_MW_CALL_TYPE:"SET_MW_CALL_TYPE",SET_LAYOUT:"SET_LAYOUT",SET_DOMINANT_SPEAKER:"SET_DOMINANT_SPEAKER",INIT_THREAD:"INIT_THREAD",ON_PARTICIPANT_LEFT:"ON_PARTICIPANT_LEFT",ON_PARTICIPANTS_ADDED:"ON_PARTICIPANTS_ADDED",ADD_PARTICIPANTS_TO_RING:"ADD_PARTICIPANTS_TO_RING",JOIN:"JOIN",JOIN_SUCCESS:"JOIN_SUCCESS",JOIN_ERROR:"JOIN_ERROR",HANGUP:"HANGUP",HANGUP_SUCCESS:"HANGUP_SUCCESS",HANGUP_ERROR:"HANGUP_ERROR",ON_CONFERENCE_STATE:"ON_CONFERENCE_STATE",DISMISS:"DISMISS",END_CALL:"END_CALL",ON_JOIN_REQUEST_SENT:"ON_JOIN_REQUEST_SENT",ON_JOIN_RESPONSE:"ON_JOIN_RESPONSE",ON_SERVER_MEDIA_UPDATE_SUCCESS:"ON_SERVER_MEDIA_UPDATE_SUCCESS",ON_CLIENT_MEDIA_UPDATE_RESPONSE:"ON_CLIENT_MEDIA_UPDATE_RESPONSE",INIT_LOCAL_USER:"INIT_LOCAL_USER",INIT_REMOTE_USERS:"INIT_REMOTE_USERS",ADD_REMOTE_STREAM:"ADD_REMOTE_STREAM",REMOVE_REMOTE_STREAM:"REMOVE_REMOTE_STREAM",REMOVE_ALL_REMOTE_STREAMS:"REMOVE_ALL_REMOTE_STREAMS",ADD_REMOTE_TRACK:"ADD_REMOTE_TRACK",REMOVE_REMOTE_TRACK:"REMOVE_REMOTE_TRACK",AUDIO_MUTED:"AUDIO_MUTED",AUDIO_UNMUTED:"AUDIO_UNMUTED",VIDEO_MUTED:"VIDEO_MUTED",VIDEO_UNMUTED:"VIDEO_UNMUTED",SELF_VIEW_COLLAPSED:"SELF_VIEW_COLLAPSED",SELF_VIEW_UNCOLLAPSED:"SELF_VIEW_UNCOLLAPSED",ADD_LOCAL_STREAM:"ADD_LOCAL_STREAM",REMOVE_LOCAL_STREAM:"REMOVE_LOCAL_STREAM",REMOVE_ALL_LOCAL_STREAMS:"REMOVE_ALL_LOCAL_STREAMS",ADD_LOCAL_SCREEN_STREAM:"ADD_LOCAL_SCREEN_STREAM",REMOVE_LOCAL_SCREEN_STREAM:"REMOVE_LOCAL_SCREEN_STREAM",REMOVE_ALL_LOCAL_SCREEN_STREAMS:"REMOVE_ALL_LOCAL_SCREEN_STREAMS",ADD_REMOTE_SCREEN_STREAM:"ADD_REMOTE_SCREEN_STREAM",REMOVE_REMOTE_SCREEN_STREAM:"REMOVE_REMOTE_SCREEN_STREAM",TOGGLE_REMOTE_STREAM:"TOGGLE_REMOTE_STREAM",SUBMIT_RATING:"SUBMIT_RATING",SUBMIT_FEEDBACK:"SUBMIT_FEEDBACK",RATING_SHOWN:"RATING_SHOWN",FEEDBACK_SHOWN:"FEEDBACK_SHOWN"};}),null);
__d('intlSummarizeNumber',['fbt','formatNumber'],(function a(b,c,d,e,f,g,h){function i(j){var k=arguments.length<=1||arguments[1]===undefined?0:arguments[1];j=parseFloat(j.toFixed(k));if(Math.abs(j)<1000)return c('formatNumber')(j,k);j=parseFloat((j/1000).toFixed(k||1));if(Math.abs(j)<1000)return String(h._("{number}k",[h.param('number',c('formatNumber')(j,k||j%1&&1))]));j=parseFloat((j/1000).toFixed(k||1));if(Math.abs(j)<1000)return String(h._("{number}M",[h.param('number',c('formatNumber')(j,k||j%1&&1))]));j=parseFloat((j/1000).toFixed(k||1));return String(h._("{number}bn",[h.param('number',c('formatNumber')(j,k||j%1&&1))]));}f.exports=i;}),null);
__d('Facepile.react',['cx','fbt','ix','intlSummarizeNumber','joinClasses','HovercardLink','Image.react','Link.react','List.react','React'],(function a(b,c,d,e,f,g,h,i,j){var k=c('React').PropTypes,l={small:24,medium:32,large:50},m=c('React').createClass({displayName:'Facepile',defaultProps:{moreColor:'blue',moreCount:0,showHovercard:false,tooltipPosition:'above'},propTypes:{className:k.string,moreColor:k.oneOf(['blue','gray']),moreCount:k.number,moreDialogLink:k.string,morePageLink:k.string,numFaces:k.number,onFaceClick:k.func,onComponentDidMount:k.func,profiles:k.arrayOf(k.shape({URL:k.any,name:k.node.isRequired,uniqueID:k.any.isRequired,profilePicURI:k.any.isRequired})).isRequired,showHovercard:k.bool,size:k.oneOf([28,'small','medium','large']).isRequired,tooltipPosition:k.oneOf(['above','below','left','right'])},_onFaceClick:function n(o,p){if(this.props.onFaceClick)this.props.onFaceClick(o,p);},componentDidMount:function n(){if(this.props.onComponentDidMount)this.props.onComponentDidMount();},getPicSize:function n(){return l[this.props.size]||this.props.size;},renderFace:function n(o,p){var q=this.getPicSize(),r=c('HovercardLink').constructEndpoint({id:o.uniqueID}).toString();return c('React').createElement('li',{className:"_43q7",key:o.uniqueID,onClick:this._onFaceClick.bind(this,o,p)},c('React').createElement(c('Link.react'),{'aria-label':o.name,className:"_2rt_ link",'data-hover':!this.props.showHovercard?'tooltip':null,'data-hovercard':this.props.showHovercard?r:null,'data-ignoreclass':"_2rt_",'data-tooltip-alignh':'left','data-tooltip-content':o.name,'data-tooltip-position':this.props.tooltipPosition,href:o.URL},c('React').createElement(c('Image.react'),{src:o.profilePicURI,width:q,height:q,className:'img'})));},renderMore:function n(){if(!this.props.moreCount)return null;var o=this.props.numFaces!=null&&this.props.numFaces<=this.props.profiles.length?this.props.moreCount+1:this.props.moreCount,p=c('intlSummarizeNumber')(o,0),q=p.length,r;if(o===0||this.props.size==='small'&&q>2||this.props.size===28&&q>3||this.props.size==='medium'&&q>3||this.props.size==='large'&&q>6){r=c('React').createElement(c('Image.react'),{src:j("97502")});}else r='+'+p;var s;if(o===1){s=i._("1 other person");}else s=i._("{num} other people",[i.param('num',o)]);var t=c('joinClasses')("_43q8"+(' '+"_43q7")+(q<2?' '+"_43qa":'')+(q===2?' '+"_43qb":'')+(q===3?' '+"_43qd":'')+(q>3?' '+"_43qe":'')+(this.props.moreColor==='blue'?' '+"_49c8":'')+(this.props.moreColor==='gray'?' '+"_49cb":''));return c('React').createElement('li',{className:t},c('React').createElement('a',{'data-hover':'tooltip','data-tooltip-position':'right','data-tooltip-content':s,ajaxify:this.props.moreDialogLink,href:this.props.morePageLink,role:'button',rel:'dialog'},r));},render:function n(){var o=c('joinClasses')(this.props.className,"_43qm"+(this.props.size==28?' '+"_3cxu":'')+(this.props.size=='small'?' '+"_43q9":'')+(this.props.size=='medium'?' '+"_43qc":'')+(this.props.size=='large'?' '+"_43qf":'')),p=this.props.numFaces==undefined?this.props.profiles:this.props.profiles.slice(0,this.props.moreCount?this.props.numFaces-1:this.props.numFaces);return c('React').createElement('div',{className:o,style:this.props.style},c('React').createElement(c('List.react'),{className:"_4cg3",direction:'horizontal',spacing:'none',border:'none'},p.map(this.renderFace),this.renderMore()));}});f.exports=m;}),null);
__d("MultiwayTypes",[],(function a(b,c,d,e,f,g){var h={OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,METHOD_NOT_ALLOWED:406,CONDITIONAL_REQUEST_FAILED:412,BUSY_HERE:486,SERVER_INTERNAL_ERROR:500,SERVICE_UNAVAILABLE:503,PRECONDITION_FAILURE:580},i={JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,EXPERIMENT:12},j={AUDIO:0,VIDEO:1,DATA:2},k={IGNORE_CALL:0,HANGUP_CALL:1,NO_ANSWER_TIMEOUT:2,CLIENT_ERROR:3,IN_ANOTHER_CALL:4,CLIENT_INTERRUPTED:5},l={CALL_ENDED:0,ANSWERED_ON_ANOTHER_DEVICE:1,IN_ANOTHER_CALL:2,CONNECTION_DROPPED:3,REJECTED_ON_ANOTHER_DEVICE:4,REMOVED_BY_PARTICIPANT:5,REJECTED_BY_CALLEE:6,INTERNAL_ERROR:7},m={SUPPORT_AUDIO:0,SUPPORT_VIDEO:1},n={GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4},o={OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10},p={UNKNOWN:0,DISCONNECTED:1,NO_ANSWER:2,REJECTED:3,UNREACHABLE:4,CONNECTION_DROPPED:5,CONTACTING:6,RINGING:7,CONNECTING:8,CONNECTED:9,PARTICIPANT_LIMIT_REACHED:10,IN_ANOTHER_CALL:11};f.exports={RtcResponseStatusCode:h,MessageType:i,MediaType:j,RingType:n,HangupReason:k,DismissReason:l,Capability:m,DeviceStatus:o,ParticipantCallState:p};}),null);
__d('MessengerRTCGroupCallContactListItem.react',['cx','fbt','ix','Image.react','Link.react','messengerContactImageReact','MultiwayTypes','React','emptyFunction'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l=c('messengerContactImageReact').comp,m=c('MultiwayTypes').ParticipantCallState,n=(k={},k[m.DISCONNECTED]=i._("Disconnected"),k[m.NO_ANSWER]=i._("No answer"),k[m.REJECTED]=i._("Rejected"),k[m.UNREACHABLE]=i._("Unreachable"),k[m.CONNECTION_DROPPED]=i._("Connection dropped"),k[m.CONTACTING]=i._("Contacting..."),k[m.RINGING]=i._("Ringing..."),k[m.CONNECTING]=i._("Connecting..."),k[m.CONNECTED]=i._("Connected"),k[m.PARTICIPANT_LIMIT_REACHED]=i._("Participant limit reached"),k[m.IN_ANOTHER_CALL]=i._("In another call"),k),o=32,p=function t(u){var v=u.isSelected,w=u.onClick,x=u.participant,y=u.participantState;return c('React').createElement(c('Link.react'),{'aria-checked':v,className:"_4nvn",onClick:s(y)?c('emptyFunction'):w,role:'checkbox'},c('React').createElement(l,{className:"_4nvr",isMessengerUser:x.is_messenger_user,size:o,src:x.image_src}),c('React').createElement('div',{className:"_4nvs"},c('React').createElement('div',{className:"_4nvt"},c('React').createElement('div',{className:"_4nv_"},x.name),c('React').createElement(q,{participant:x,participantState:y})),c('React').createElement(r,{isSelected:v,participantState:y})));},q=function t(u){var v=u.participant.vanity,w=u.participantState;if(w){var x=n[w.state]||i._("Unknown");return c('React').createElement('div',{className:"_4nw0"},x);}if(v)return c('React').createElement('div',{className:"_4nw0"},'@',v);return null;},r=function t(u){var v=u.isSelected,w=u.participantState;if(s(w)){return c('React').createElement('div',{className:"_1j79"},i._("In call"));}else if(v)return c('React').createElement('div',{className:"_1j79"},c('React').createElement(c('Image.react'),{src:j("86852")}));return null;};function s(t){if(!t)return false;switch(t.state){case m.CONTACTING:case m.RINGING:case m.CONNECTING:case m.CONNECTED:return true;default:return false;}}f.exports=p;}),null);
__d('MessengerRTCGroupCallContactList.react',['cx','immutable','MessengerRTCGroupCallContactListItem.react','MessengerScrollableArea.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i=function j(k){var l=k.isParticipantSelected,m=k.onClick,n=k.participants,o=k.participantStates,p=o===undefined?c('immutable').Map():o,q=n.map(function(r){return c('React').createElement(c('MessengerRTCGroupCallContactListItem.react'),{isSelected:l.get(r.id),key:r.id,onClick:function(s){function t(){return s.apply(this,arguments);}t.toString=function(){return s.toString();};return t;}(function(){return m(r.id);}),participant:r,participantState:p.get(r.fbid||'')});});return c('React').createElement(c('MessengerScrollableArea.react'),{className:"_12zw"},q);};f.exports=i;}),null);
__d('MessengerRTCGroupCallIncomingDialog.react',['cx','fbt','Facepile.react','ImageBlock.react','ImmutableObject','messengerDialogsRe','messengerContactImageReact','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerContactImageReact').comp,k=c('messengerDialogBodyReact').comp,l=c('React').PropTypes,m=400,n=5,o=50,p=function v(w){var x=w.hasVideo,y=w.caller,z=w.callees,aa=w.onAnswer,ba=w.onIgnore;return c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:false,shown:true,onToggle:function ca(da){return u(da,ba);},width:m},c('React').createElement(q,{hasVideo:x}),c('React').createElement(r,{hasVideo:x,caller:y,callees:z}),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ignore"),onClick:function ca(){return s(ba);},type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Answer Call"),onClick:function ca(){return t(aa);},type:'primary'})));},q=function v(w){var x=w.hasVideo;return c('React').createElement(c('MessengerDialogHeader.react'),null,x?i._("Incoming group video chat"):i._("Incoming group call"));},r=function v(w){var x=w.hasVideo,y=w.caller,z=w.callees;return c('React').createElement(k,null,c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(j,{isMessengerUser:y.is_messenger_user,size:o,src:y.big_image_src||y.image_src}),c('React').createElement('div',{className:"_2n1r"},c('React').createElement('div',{className:"_2n1s"},x?i._("{caller name} started a group video chat in a group you're a member of.",[i.param('caller name',y.name)]):i._("{caller name} started a group call in a group you're a member of.",[i.param('caller name',y.name)])),c('React').createElement(c('Facepile.react'),{moreCount:Math.max(0,z.length-n),profiles:z.map(function(aa){var ba=aa.name,ca=aa.fbid,da=aa.big_image_src;return {name:ba,uniqueID:ca,profilePicURI:da};}).slice(0,n),size:'medium'}),c('React').createElement('div',{className:"_2n1t"},x?i._("Video will start as soon as you answer."):i._("The call will start as soon as you answer.")))));},s=function v(w){c('messengerDialogsRe').removeAllDialogs();w();},t=function v(w){c('messengerDialogsRe').removeAllDialogs();w();},u=function v(w,x){if(!w){c('messengerDialogsRe').removeAllDialogs();x();}};p.propTypes={caller:l.instanceOf(c('ImmutableObject')).isRequired,callees:l.arrayOf(l.instanceOf(c('ImmutableObject'))).isRequired,hasVideo:l.bool.isRequired,onAnswer:l.func.isRequired,onIgnore:l.func.isRequired};f.exports=p;}),null);
__d('RTCEndCallReason',['fbt','FBRTCConstants','MultiwayTypes'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('FBRTCConstants').CallEndReason,j=c('FBRTCConstants').CollabCallEndSubreason,k=c('MultiwayTypes').DismissReason,l=c('MultiwayTypes').HangupReason,m=c('MultiwayTypes').RtcResponseStatusCode;function n(o){this.$RTCEndCallReason1=-1;this.$RTCEndCallReason3='local';this.$RTCEndCallReason4=false;if(typeof o==='string'||o instanceof String){this.$RTCEndCallReason1=i.strNames.indexOf(o);}else this.$RTCEndCallReason1=o;}n.prototype.setSubreason=function(o){this.$RTCEndCallReason2=o;return this;};n.prototype.getSubreason=function(){return this.$RTCEndCallReason2;};n.prototype.setRemoteEnded=function(o){this.$RTCEndCallReason3=o?'remote':'local';return this;};n.prototype.toStrName=function(){var o=arguments.length<=0||arguments[0]===undefined?true:arguments[0];return o?this.$RTCEndCallReason5()+'_'+this.$RTCEndCallReason3:this.$RTCEndCallReason5();};n.prototype.$RTCEndCallReason5=function(){if(this.$RTCEndCallReason1<0||this.$RTCEndCallReason1>i.strNames.length)return 'Unknown';return i.strNames[this.$RTCEndCallReason1];};n.prototype.getReasonID=function(){return this.$RTCEndCallReason1;};n.prototype.toString=function(){var o=arguments.length<=0||arguments[0]===undefined?false:arguments[0],p=(this.$RTCEndCallReason6()||'').toString();return o?p+' '+this.$RTCEndCallReason7():p;};n.prototype.$RTCEndCallReason6=function(){switch(this.$RTCEndCallReason1){case i.NO_ANSWER_TIMEOUT:case i.IGNORE_CALL:return h._("No Answer");case i.OTHER_NOT_CAPABLE:if(this.$RTCEndCallReason2===j.MCU_INVALID_STREAM_CONFIGURATION)return h._("Too many clients connected to the room");case i.INCOMING_TIMEOUT:case i.NO_PERMISSION:case i.OTHER_CARRIER_BLOCKED:return h._("Not Reachable");case i.SIGNALING_MESSAGE_FAILED:case i.WEBRTC_ERROR:case i.NO_UI_ERROR:case i.CALLER_NOT_VISIBLE:case i.CLIENT_ERROR:return h._("Call Failed");case i.UNSUPPORTED_VERSION:return h._("Can't connect Call");case i.IN_ANOTHER_CALL:return h._("On Another Call");case i.CARRIER_BLOCKED:return h._("Switch to Wi-Fi to complete your call");case i.CLIENT_INTERRUPTED:return h._("Call Interrupted");case i.HANGUP_CALL:case i.ACCEPT_AFTER_HANGUP:return h._("Call ended");case i.CONNECTION_DROPPED:return h._("Connection lost");case i.OTHER_INSTANCE_HANDLED:return null;default:return null;}};n.prototype.$RTCEndCallReason7=function(){if(this.$RTCEndCallReason1!==i.OTHER_NOT_CAPABLE&&this.$RTCEndCallReason1!==i.SIGNALING_MESSAGE_FAILED)return '';switch(this.$RTCEndCallReason2){case j.REMOTE_PEER_HANGUP:case j.REMOTE_PEER_REJECT:return '';case j.CLOSED_BY_MCU:return '- Call expired';case j.CLOSED_AS_STALE:return '- Server failed, call is stale';case j.CALL_INITIALIZATION_FAILED:return '- Call initialization to room failed';case j.SIP_CONNECTION_INITIALIZATION_FAILED:return 'or No Answer';case j.LOST_MCU_CONNECTION:return '- MCU Media connection failed';case j.LOST_MCU_THRIFT_CONNECTION:return '- MCU infrastructure dropped connection';case j.LOST_SIP_ADAPTER_CONNECTION:return '- SIP infrastructure dropped connection';case j.MCU_NO_AUDIO_STREAM:return '- Invalid audio stream';case j.MCU_INVALID_STREAM_CONFIGURATION:return '- Invalid stream configuration';case j.UNKNOWN:default:return '- Unexpected call failure: '+(this.$RTCEndCallReason2||'null');}};n.fromHangupReason=function(o){switch(o){case l.IGNORE_CALL:return new n(i.IGNORE_CALL);case l.NO_ANSWER_TIMEOUT:return new n(i.NO_ANSWER_TIMEOUT);case l.HANGUP_CALL:return new n(i.HANGUP_CALL);case l.CLIENT_ERROR:return new n(i.CLIENT_ERROR);case l.IN_ANOTHER_CALL:return new n(i.IN_ANOTHER_CALL);case l.CLIENT_INTERRUPTED:return new n(i.CLIENT_INTERRUPTED);default:return new n(i.HANGUP_CALL);}};n.fromDismissRequest=function(o){if(!o)return new n(i.HANGUP_CALL);switch(o.reason){case k.ANSWERED_ON_ANOTHER_DEVICE:case k.REJECTED_ON_ANOTHER_DEVICE:return new n(i.OTHER_INSTANCE_HANDLED);case k.CALL_ENDED:return new n(i.HANGUP_CALL);case k.IN_ANOTHER_CALL:return new n(i.IN_ANOTHER_CALL);case k.CONNECTION_DROPPED:return new n(i.CONNECTION_DROPPED);case k.REMOVED_BY_PARTICIPANT:return new n(i.HANGUP_CALL);case k.REJECTED_BY_CALLEE:return new n(i.IGNORE_CALL);case k.INTERNAL_ERROR:return new n(i.SIGNALING_MESSAGE_FAILED);default:return new n(i.HANGUP_CALL);}};n.fromResponseStatusCode=function(o){switch(o){case m.PRECONDITION_FAILURE:case m.METHOD_NOT_ALLOWED:case m.UNAUTHORIZED:return new n(i.NO_PERMISSION);case m.SERVICE_UNAVAILABLE:return new n(i.SIGNALING_MESSAGE_FAILED);case m.SERVER_INTERNAL_ERROR:case m.BAD_REQUEST:case m.BUSY_HERE:case m.CONDITIONAL_REQUEST_FAILED:case m.NOT_FOUND:return new n(i.CLIENT_ERROR);default:return new n(i.HANGUP_CALL);}};f.exports=n;}),null);
__d("MediaStream",[],(function a(b,c,d,e,f,g){f.exports=window.MediaStream||window.webkitMediaStream;}),null);
__d('RTCAudioTrackNoiseDetector',['invariant','Promise','MediaStream'],(function a(b,c,d,e,f,g,h){'use strict';var i='audio track with absolute silence',j='audio track data timeout',k='wrong track type, expected "audio"',l=100,m={ABSOLUTE_SILENCE_ERROR:i,DATA_TIMEOUT_ERROR:j,WRONG_TRACK_TYPE_ERROR:k,detect:function n(o,p){if('kind' in o&&o.kind!=='audio')return c('Promise').reject(new Error(k));var q=new (c('MediaStream'))();q.addTrack(o);var r=new AudioContext(),s=r.createMediaStreamSource(q),t=r.createScriptProcessor(0,1,1),u=l,v=function w(){t!=null||h(0);t.onaudioprocess=null;t.disconnect();t=null;s!=null||h(0);s.disconnect();s=null;q!=null||h(0);q.removeTrack(o);q=null;r!=null||h(0);return c('Promise').resolve(r.close())['catch'](function(){return c('Promise').resolve();}).then(function(){r=null;});};return c('Promise').race([new (c('Promise'))(function(w,x){t!=null||h(0);t.onaudioprocess=function(y){var z=y.inputBuffer;for(var aa=z.getChannelData(0),ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var da;if(ba){if(ca>=aa.length)break;da=aa[ca++];}else{ca=aa.next();if(ca.done)break;da=ca.value;}var ea=da;if(ea!==0){w();return;}}if(u>0){u--;}else x(new Error(i));};s!=null||h(0);s.connect(t);r!=null||h(0);t.connect(r.destination);}),new (c('Promise'))(function(w){return setTimeout(w,p);}).then(function(){throw new Error(j);})]).then(function(){return v();})['catch'](function(w){return v().then(function(){throw w;});});}};f.exports=m;}),null);
__d('RTCVideoTrackActivityDetector',['invariant','Promise','MediaStream'],(function a(b,c,d,e,f,g,h){'use strict';var i=window.URL||window.webkitURL,j=HTMLMediaElement&&'srcObject' in HTMLMediaElement.prototype,k='video track playback timeout',l='unexpected video track ready state',m='wrong track type, expected "video"',n={PLAYBACK_TIMEOUT_ERROR:k,WRONG_READY_STATE_ERROR:l,WRONG_TRACK_TYPE_ERROR:m,detect:function o(p,q){if('kind' in p&&p.kind!=='video')return c('Promise').reject(new Error(m));var r=document.createElement('video');r.muted=true;var s=new (c('MediaStream'))();s.addTrack(p);var t=void 0,u=0,v=function w(){clearInterval(u);if(r){r.pause();if(j){r.srcObject=null;}else if(r.src){i.revokeObjectURL(r.src);r.src='';}r.removeEventListener('timeupdate',t);r=null;}if(s){s.removeTrack(p);s=null;}};return c('Promise').race([new (c('Promise'))(function(w,x){r!=null||h(0);if(j){r.srcObject=s;}else r.src=i.createObjectURL(s);t=function y(z){r!=null||h(0);if(r.currentTime>0)if(p.readyState==='live'){w();v();}else x(new Error(l));};c('Promise').resolve(r.pause()).then(function(){r!=null||h(0);return r.play();}).then(function(){t();r!=null||h(0);r.addEventListener('timeupdate',t);u=setInterval(t,50);})['catch'](function(y){return x(y);});}),new (c('Promise'))(function(w){return setTimeout(w,q);}).then(function(){throw new Error(k);})])['catch'](function(w){v();throw w;});}};f.exports=n;}),null);
__d('RTCMediaStreamValidator',['Promise','MediaStream','RTCAudioTrackNoiseDetector','RTCVideoTrackActivityDetector'],(function a(b,c,d,e,f,g){'use strict';var h='no audio tracks',i='no video tracks',j='too many audio tracks',k='too many video tracks',l='unexpected audio track(s)',m='unexpected video track(s)',n={NO_AUDIO_TRACKS_ERROR:h,NO_VIDEO_TRACKS_ERROR:i,TOO_MANY_AUDIO_TRACKS_ERROR:j,TOO_MANY_VIDEO_TRACKS_ERROR:k,UNEXPECTED_AUDIO_TRACKS_ERROR:l,UNEXPECTED_VIDEO_TRACKS_ERROR:m,validate:function q(r,s){var t=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],u=t.audio,v=u===undefined?1000:u,w=t.video,x=w===undefined?1000:w;return c('Promise').all([o(r,s,v),p(r,s,x)]).then(function(){return r;});}};function o(q,r,s){var t=q.getAudioTracks();if(!r.audio)return t.length>0?c('Promise').reject(new Error(l)):c('Promise').resolve(q);if(t.length<1){return c('Promise').reject(new Error(h));}else if(t.length>1)return c('Promise').reject(new Error(j));return c('RTCAudioTrackNoiseDetector').detect(t[0],s).then(function(){return q;});}function p(q,r,s){var t=q.getVideoTracks();if(!r.video)return t.length>0?c('Promise').reject(new Error(m)):c('Promise').resolve(q);if(t.length<1){return c('Promise').reject(new Error(i));}else if(t.length>1)return c('Promise').reject(new Error(k));return c('RTCVideoTrackActivityDetector').detect(t[0],s).then(function(){return q;});}f.exports=n;}),null);
__d('RTCUserMediaConstraints',['FBRTCConstants','RTCConfig'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').VideoQuality,i={width:1920,height:1080,frameRate:30},j={width:1280,height:720,frameRate:30},k={width:854,height:480,frameRate:30},l={width:320,height:180,frameRate:15},m={audio:function r(s){return s?{deviceId:s}:true;},video:function r(s,t){var u=arguments.length<=2||arguments[2]===undefined?c('RTCConfig').CollaborationCallQuality.videoToRoom:arguments[2];if(s===h.NO_VIDEO)return false;var v=t?{deviceId:t}:null;if(s===h.CUSTOM_VIDEO)return babelHelpers['extends']({},u,v);var w=n(s);return babelHelpers['extends']({width:o(w,'width'),height:o(w,'height'),frameRate:o(w,'frameRate')},v);},chromeMediaSource:function r(s,t){var u=s.video,v=m.chromify(u);if(typeof v!=='object')return {audio:false,video:Boolean(v)};var w=v.mandatory,x=v.optional,y=x===undefined?[]:x;return {audio:false,video:{mandatory:babelHelpers['extends']({},w,{chromeMediaSource:'desktop',chromeMediaSourceId:t}),optional:[{googTemporalLayeredScreencast:true}].concat(y)}};},chromify:function r(s){if(!s||typeof s!=='object')return Boolean(s);if(!q(s))return s;var t=s.mandatory,u=t===undefined?{}:t,v=s.optional,w=v===undefined?[]:v;for(var x=Object.entries(s),y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var aa;if(y){if(z>=x.length)break;aa=x[z++];}else{z=x.next();if(z.done)break;aa=z.value;}var ba=aa,ca=ba[0],da=ba[1];if(ca==='require'||ca==='advanced'||ca==='mediaSource')continue;var ea=da&&typeof da==='object'?da:{ideal:da};if(Number.isFinite(ea.exact)){ea.min=ea.exact;ea.max=ea.exact;}var fa=ea.ideal,ga=ea.exact;if(fa!==undefined)if(Number.isFinite(fa)){var ha,ia;w.push((ha={},ha[p(ca,'min')]=fa,ha),(ia={},ia[p(ca,'max')]=fa,ia));}else{var ja;w.push((ja={},ja[p(ca)]=fa,ja));}if(ga!==undefined&&!Number.isFinite(ga)){u[p(ca)]=ga;}else{var ka=['min','max'];for(var la=0;la<ka.length;la++){var ma=ka[la];if(Number.isFinite(ea[ma]))u[p(ca,ma)]=ea[ma];}}}if(s.advanced)w.push.apply(w,s.advanced);var na={};if(Object.keys(u).length>0)na.mandatory=u;if(w.length>0)na.optional=w;return na;}};function n(r){switch(r){case h.FHD_VIDEO:return i;case h.HD_VIDEO:return j;case h.LQ_VIDEO:return l;case h.SD_VIDEO:return k;default:return j;}}function o(r,s){var t=r[s];return {min:Math.min(l[s],t),max:Math.max(i[s],t),ideal:t};}function p(r,s){if(s)return ''+s+r.charAt(0).toUpperCase()+r.slice(1);return r==='deviceId'?'sourceId':r;}function q(r){return Object.keys(r).some(function(s){return s!=='mandatory'&&s!=='optional';});}f.exports=m;}),null);
__d('RTCUtils',['Promise','CurrentUser','RTCConfig','RTCEndCallReason','RTCMediaStreamValidator','RTCScreenSharing','RTCUserMediaConstraints','UserAgent','FBRTCConstants','randomInt'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').VideoQuality,i={generateRandomInt:function j(){return c('randomInt')(0,4294967294)+1;},isGroupCall:function j(k){return k.split(':')[0]==='GROUP';},getPeerID:function j(k){if(this.isGroupCall(k))throw new Error('Not a P2P call: '+k);var l=k.split(':'),m=l.slice(1);return m[0]===c('CurrentUser').getID()?m[1]:m[0];},createRequestHeader:function j(k,l,m){var n={type:k,transactionId:i.generateRandomInt().toString(),retryCount:0,conferenceName:l};if(m)n.serverInfoData=m;return n;},createResponseHeader:function j(k,l){var m={type:k.type,transactionId:k.transactionId,retryCount:0,conferenceName:k.conferenceName,responseStatusCode:l};if(k.serverInfoData)m.serverInfoData=k.serverInfoData;return m;},getUserMedia:function j(k){var l=navigator,m=l.mediaDevices;if(typeof k.video==='object'&&k.video.mediaSource)return c('RTCScreenSharing').getUserMedia(k);var n=this._parseConstraints(k);return new (c('Promise'))(function(o,p){if(m&&typeof m.getUserMedia==='function'){o(m.getUserMedia(n));}else if(navigator.getUserMedia){navigator.getUserMedia(n,o,p);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(n,o,p);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(n,o,p);}else if(navigator.msGetUserMedia){navigator.msGetUserMedia(n,o,p);}else p('getUserMedia not supported');})['catch'](function(o){throw this._shimError(o);}.bind(this));},_parseConstraints:function j(k){if(c('UserAgent').isBrowser('Chrome')||c('UserAgent').isBrowser('Opera')){var l=k.audio,m=k.video,n={};if(l!=undefined)n.audio=c('RTCUserMediaConstraints').chromify(l);if(m!=undefined)n.video=c('RTCUserMediaConstraints').chromify(m);return n;}return k;},getUserMediaWithValidation:function j(k){var l=arguments.length<=1||arguments[1]===undefined?5:arguments[1],m={audio:1000,video:1000};return new (c('Promise'))(function(n,o){var p=function(q){this.getUserMedia(k).then(function(r){return c('RTCMediaStreamValidator').validate(r,k,m).then(n)['catch'](function(s){this.stopMediaStream(r);throw s;}.bind(this));}.bind(this),o)['catch'](function(r){if(q>0){p(q-1);}else o(r);});}.bind(this);p(l);}.bind(this));},initLocalStream:function j(k){return i.getUserMedia({audio:c('RTCUserMediaConstraints').audio(),video:c('RTCUserMediaConstraints').video(k?h.HD_VIDEO:h.NO_VIDEO)});},initLocalScreenStream:function j(){var k=arguments.length<=0||arguments[0]===undefined?'screen':arguments[0];return i.getUserMedia({audio:false,video:babelHelpers['extends']({},c('RTCConfig').CollaborationCallQuality.screen_v2||c('RTCConfig').CollaborationCallQuality.screen,{mediaSource:k})});},isFullScreen:function j(){return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);},requestFullScreen:function j(){var k=arguments.length<=0||arguments[0]===undefined?document.documentElement:arguments[0];if(typeof k.requestFullscreen==='function'){k.requestFullscreen();}else if(typeof k.msRequestFullscreen==='function'){k.msRequestFullscreen();}else if(typeof k.mozRequestFullScreen==='function'){k.mozRequestFullScreen();}else if(typeof k.webkitRequestFullscreen==='function')k.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);},exitFullScreen:function j(){if(typeof document.exitFullscreen==='function'){document.exitFullscreen();}else if(typeof document.msExitFullscreen==='function'){document.msExitFullscreen();}else if(typeof document.mozCancelFullScreen==='function'){document.mozCancelFullScreen();}else if(typeof document.webkitExitFullscreen==='function')document.webkitExitFullscreen();},toggleFullScreen:function j(){if(this.isFullScreen()){this.exitFullScreen();}else this.requestFullScreen();},endCallReasonFromHangupReason:function j(k){return c('RTCEndCallReason').fromHangupReason(k).getReasonID();},endCallReasonFromDismissRequest:function j(k){return c('RTCEndCallReason').fromDismissRequest(k).getReasonID();},endCallReasonFromResponseStatusCode:function j(k){return c('RTCEndCallReason').fromResponseStatusCode(k).getReasonID();},stopMediaStream:function j(k){if(!k.active&&'active' in k)return;for(var l=k.getTracks(),m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var o;if(m){if(n>=l.length)break;o=l[n++];}else{n=l.next();if(n.done)break;o=n.value;}var p=o;if(p.readyState!=='ended')p.stop();}},_shimError:function j(k){var l=k.message,m=k.name,n=new Error(l==='The operation is insecure.'?'The request is not allowed by the user agent or the platform in the'+'current context.':l);n.name={ConstraintNotSatisfiedError:'OverconstrainedError',NotSupportedError:'TypeError',PermissionDeniedError:'NotAllowedError',SecurityError:'NotAllowedError'}[m]||m;return n;}};f.exports=i;}),null);
__d('MessengerRTCGroupCallIncomingDialogController',['EventEmitter','FBRTCSoundController','MercuryIDs','MercuryParticipants','messengerDialogsRe','MessengerRTCGroupCallIncomingDialog.react','MessengerRTCIncomingDialog.react','React','RTCUtils','XGroupCallController','randomInt','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=70000;h=babelHelpers.inherits(k,c('EventEmitter'));i=h&&h.prototype;function k(l,m,n,o,p,q){i.constructor.call(this);this.$MessengerRTCGroupCallIncomingDialogController1=l;this.$MessengerRTCGroupCallIncomingDialogController2=m;this.$MessengerRTCGroupCallIncomingDialogController3=n;this.$MessengerRTCGroupCallIncomingDialogController4=o;this.$MessengerRTCGroupCallIncomingDialogController5=p;this.$MessengerRTCGroupCallIncomingDialogController6=q;this.$MessengerRTCGroupCallIncomingDialogController7=null;}k.prototype.serverInfoData=function(){return this.$MessengerRTCGroupCallIncomingDialogController6;};k.prototype.showIncomingDialog=function(){this.$MessengerRTCGroupCallIncomingDialogController7=c('setTimeoutAcrossTransitions')(this.$MessengerRTCGroupCallIncomingDialogController8.bind(this),j);var l=this.$MessengerRTCGroupCallIncomingDialogController1+c('randomInt')(0,4294967295).toString();c('FBRTCSoundController').playIncomingRingtone(l,this.$MessengerRTCGroupCallIncomingDialogController1,true);if(!c('RTCUtils').isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1)){c('messengerDialogsRe').showDialog(function(){return c('React').createElement(c('MessengerRTCIncomingDialog.react'),{callerID:this.$MessengerRTCGroupCallIncomingDialogController3,isVideoCall:this.$MessengerRTCGroupCallIncomingDialogController5,onAccept:function(){return this.$MessengerRTCGroupCallIncomingDialogController9();}.bind(this),onDecline:function(){return this.$MessengerRTCGroupCallIncomingDialogController10();}.bind(this)});}.bind(this));return;}var m=[this.$MessengerRTCGroupCallIncomingDialogController3].concat(this.$MessengerRTCGroupCallIncomingDialogController4);c('MercuryParticipants').getMulti(m.map(c('MercuryIDs').getParticipantIDFromUserID),function(n){return c('messengerDialogsRe').showDialog(function(){return c('React').createElement(c('MessengerRTCGroupCallIncomingDialog.react'),{caller:n[c('MercuryIDs').getParticipantIDFromUserID(this.$MessengerRTCGroupCallIncomingDialogController3)],callees:Object.values(n).filter(function(o){var p=o.fbid;return p!==this.$MessengerRTCGroupCallIncomingDialogController3;}.bind(this)),hasVideo:this.$MessengerRTCGroupCallIncomingDialogController5,onAnswer:function(){return this.$MessengerRTCGroupCallIncomingDialogController9();}.bind(this),onIgnore:function(){return this.$MessengerRTCGroupCallIncomingDialogController10();}.bind(this)});}.bind(this));}.bind(this));};k.prototype.cancel=function(){if(this.$MessengerRTCGroupCallIncomingDialogController7)clearTimeout(this.$MessengerRTCGroupCallIncomingDialogController7);c('messengerDialogsRe').removeAllDialogs();c('FBRTCSoundController').stopIncomingRingtone();};k.prototype.$MessengerRTCGroupCallIncomingDialogController9=function(){this.cancel();var l=c('XGroupCallController').getURIBuilder().setString('conference_name',this.$MessengerRTCGroupCallIncomingDialogController1).setInt('call_id',this.$MessengerRTCGroupCallIncomingDialogController2).setBool('has_video',this.$MessengerRTCGroupCallIncomingDialogController5).setString('server_info_data',this.$MessengerRTCGroupCallIncomingDialogController6).getURI();this.emit('answerCall',this.$MessengerRTCGroupCallIncomingDialogController1,l);};k.prototype.$MessengerRTCGroupCallIncomingDialogController10=function(){this.cancel();this.emit('ignoreCall');};k.prototype.$MessengerRTCGroupCallIncomingDialogController8=function(){this.cancel();this.emit('timeout');};f.exports=k;}),null);
__d('MessengerRTCGroupCallRingParticipantsRow.react',['cx','fbt','React','intlList'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=function k(l){var m=l.names;return c('React').createElement('div',{className:"_1wsd"},c('React').createElement('div',{className:"_1wse"},i._("Ring:")),c('React').createElement('div',{className:"_1wsg"},c('intlList')(m,c('intlList').CONJUNCTIONS.NONE)));};f.exports=j;}),null);
__d('MessengerRTCGroupCallThreadRow.react',['cx','fbt','MercuryThreadTitle.react','messengerThreadImageReact','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerThreadImageReact').comp,k=function l(m){var n=m.displayAddMemberWarning,o=m.participants,p=m.thread,q=m.viewerID;return c('React').createElement('div',{className:"_5y31"},c('React').createElement(j,{className:"_5y32",participants:o,thread:p,viewer:q}),c('React').createElement('div',{className:"_5y34"},c('React').createElement(c('MercuryThreadTitle.react'),{className:"_5y37",thread:p,viewer:q}),n?c('React').createElement('div',{className:"_1apf"},i._("People you add to this group video will see previous messages in this conversation.")):null));};f.exports=k;}),null);
__d('MessengerRTCGroupCallUnsupportedBrowserDialog.react',['fbt','Link.react','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','React','UserAgent'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('messengerDialogBodyReact').comp,j=function n(o){var p=o.hasVideo,q=o.onUnmount;return c('React').createElement(c('MessengerDialog.react'),{onToggle:q},c('React').createElement(c('MessengerDialogHeader.react'),null,k(p)),c('React').createElement(i,null,l(p)),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:h._("OK"),onClick:q,type:'primary'})));};function k(n){return n?h._("Switch Browsers to Make Group Video Chats"):h._("Switch browsers to make group calls");}function l(n){return n?h._("Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group video chat, open in {link to install chrome}.",[h.param('browser name, i.e. Internet Explorer or Safari',m()),h.param('link to install chrome',c('React').createElement(c('Link.react'),{href:'https://www.google.com/chrome/index.html',target:'_blank'},'Google Chrome'))]):h._("Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group call, open in {link to install chrome}.",[h.param('browser name, i.e. Internet Explorer or Safari',m()),h.param('link to install chrome',c('React').createElement(c('Link.react'),{href:'https://www.google.com/chrome/index.html',target:'_blank'},'Google Chrome'))]);}function m(){if(c('UserAgent').isBrowser('Firefox')){return h._("Firefox");}else if(c('UserAgent').isBrowser('IE')){return h._("Internet Explorer");}else if(c('UserAgent').isBrowser('Safari')){return h._("Safari");}else return h._("your browser");}f.exports=j;}),null);
__d('MessengerRTCGroupCallUnsupportedBrowserDialogController',['DOM','MessengerRTCGroupCallUnsupportedBrowserDialog.react','React','ReactDOM'],(function a(b,c,d,e,f,g){'use strict';var h={_container:c('DOM').create('div'),render:function i(j){var k=j.hasVideo;c('ReactDOM').render(c('React').createElement(c('MessengerRTCGroupCallUnsupportedBrowserDialog.react'),{hasVideo:k,onUnmount:function(){return this.unmount();}.bind(this)}),this._container);},unmount:function i(){c('ReactDOM').unmountComponentAtNode(this._container);}};f.exports=h;}),null);
__d('Dialog',['fbt','Animation','Arbiter','AsyncRequest','Button','ContextualThing','CSS','DOM','Event','Focus','Form','HTML','Keys','Locale','Parent','Run','Style','URI','Vector','bind','createArrayFromMixed','emptyFunction','getObjectValues','getOverlayZIndex','removeFromArray','shield'],(function $module_Dialog(global,require,requireDynamic,requireLazy,module,exports,fbt){var _supportsPositionFixed2=function _supportsPositionFixed(){var body=document.body,test=document.createElement('div'),control=document.createElement('div');body.insertBefore(test,body.firstChild);body.insertBefore(control,body.firstChild);test.style.position='fixed';test.style.top='20px';var result=test.offsetTop!==control.offsetTop;body.removeChild(test);body.removeChild(control);_supportsPositionFixed2=require('emptyFunction').thatReturns(result);return result;};function Dialog(model){'use strict';this._show_loading=true;this._auto_focus=true;this._submit_on_enter=false;this._fade_enabled=true;this._onload_handlers=[];this._top=125;this._uniqueID='dialog_'+Dialog._globalCount++;this._content=null;this._obj=null;this._popup=null;this._overlay=null;this._causal_elem=null;this._previous_focus=null;this._buttons=[];this._buildDialog();if(model)this._setFromModel(model);Dialog._init();}Dialog.prototype.show=function(){'use strict';this._showing=true;if(this._async_request){if(this._show_loading)this.showLoading();}else this._update();return this;};Dialog.prototype.showLoading=function(){'use strict';this._loading=true;require('CSS').addClass(this._frame,'dialog_loading_shown');this._renderDialog();return this;};Dialog.prototype.hide=function(){'use strict';if(!this._showing&&!this._loading)return this;this._showing=false;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}if(this._fade_enabled&&Dialog._stack.length<=1){this._fadeOut();}else this._hide();return this;};Dialog.prototype.cancel=function(){'use strict';if(!this._cancelHandler||this._cancelHandler()!==false)this.hide();};Dialog.prototype.getRoot=function(){'use strict';return this._obj;};Dialog.prototype.getBody=function(){'use strict';return require('DOM').scry(this._obj,'div.dialog_body')[0];};Dialog.prototype.getButtonElement=function(button){'use strict';if(typeof button=='string')button=Dialog._findButton(this._buttons,button);if(!button||!button.name)return null;var inputs=require('DOM').scry(this._popup,'input'),name_filter=function name_filter(elem){return elem.name==button.name;};return inputs.filter(name_filter)[0]||null;};Dialog.prototype.getContentNode=function(){'use strict';return require('DOM').find(this._content,'div.dialog_content');};Dialog.prototype.getFormData=function(){'use strict';return require('Form').serialize(this.getContentNode());};Dialog.prototype.setAllowCrossPageTransition=function(allow){'use strict';this._cross_transition=allow;return this;};Dialog.prototype.setAllowCrossQuicklingNavigation=function(allow){'use strict';this._cross_quickling=allow;return this;};Dialog.prototype.setShowing=function(){'use strict';this.show();return this;};Dialog.prototype.setHiding=function(){'use strict';this.hide();return this;};Dialog.prototype.setTitle=function(title){'use strict';var node=this._nodes.title,inner_node=this._nodes.title_inner,content_node=this._nodes.content;require('DOM').setContent(inner_node,this._format(title||''));require('CSS').conditionShow(node,!!title);require('CSS').conditionClass(content_node,'dialog_content_titleless',!title);return this;};Dialog.prototype.setBody=function(body){'use strict';require('DOM').setContent(this._nodes.body,this._format(body));return this;};Dialog.prototype.setExtraData=function(data){'use strict';this._extra_data=data;return this;};Dialog.prototype.setReturnData=function(data){'use strict';this._return_data=data;return this;};Dialog.prototype.setShowLoading=function(show){'use strict';this._show_loading=show;return this;};Dialog.prototype.setFullBleed=function(is_full_bleed){'use strict';this._full_bleed=is_full_bleed;this._updateWidth();require('CSS').conditionClass(this._obj,'full_bleed',is_full_bleed);return this;};Dialog.prototype.setCausalElement=function(elem){'use strict';this._causal_elem=elem;return this;};Dialog.prototype.setUserData=function(data){'use strict';this._user_data=data;return this;};Dialog.prototype.getUserData=function(){'use strict';return this._user_data;};Dialog.prototype.setAutohide=function(autohide){'use strict';if(autohide){if(this._showing){this._autohide_timeout=setTimeout(require('shield')(this.hide,this),autohide);}else this._autohide=autohide;}else{this._autohide=null;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}}return this;};Dialog.prototype.setSummary=function(summary){'use strict';var node=this._nodes.summary;require('DOM').setContent(node,this._format(summary||''));require('CSS').conditionShow(node,!!summary);return this;};Dialog.prototype.setButtons=function(b){'use strict';var buttons,button;if(!Array.isArray(b)){buttons=Array.from(arguments);}else buttons=b;for(var i=0;i<buttons.length;++i)if(typeof buttons[i]=='string'){button=Dialog._findButton(Dialog._STANDARD_BUTTONS,buttons[i]);buttons[i]=button;}this._buttons=buttons;var button_content=[];if(buttons&&buttons.length>0)for(var ii=0;ii<buttons.length;ii++){button=buttons[ii];var button_input=require('DOM').create('input',{type:'button',name:button.name||'',value:button.label}),button_node=require('DOM').create('label',{className:'uiButton uiButtonLarge uiButtonConfirm'},button_input);if(button.className){button.className.split(/\s+/).forEach(function(e){require('CSS').addClass(button_node,e);});if(require('CSS').hasClass(button_node,'inputaux')){require('CSS').removeClass(button_node,'inputaux');require('CSS').removeClass(button_node,'uiButtonConfirm');}if(require('CSS').hasClass(button_node,'uiButtonSpecial'))require('CSS').removeClass(button_node,'uiButtonConfirm');}if(button.icon)require('DOM').prependContent(button_node,require('DOM').create('img',{src:button.icon,className:'img mrs'}));if(button.disabled)require('Button').setEnabled(button_node,false);require('Event').listen(button_input,'click',this._handleButton.bind(this,button.name));for(var attr in button)if(attr.indexOf('data-')===0&&attr.length>5)button_input.setAttribute(attr,button[attr]);button_content.push(button_node);}require('DOM').setContent(this._nodes.buttons,button_content);this._updateButtonVisibility();return this;};Dialog.prototype.setButtonsMessage=function(message){'use strict';require('DOM').setContent(this._nodes.button_message,this._format(message||''));this._has_button_message=!!message;this._updateButtonVisibility();return this;};Dialog.prototype._updateButtonVisibility=function(){'use strict';var show=this._buttons.length>0||this._has_button_message;require('CSS').conditionShow(this._nodes.button_wrapper,show);require('CSS').conditionClass(this._obj,'omitDialogFooter',!show);};Dialog.prototype.setClickButtonOnEnter=function(input_id,button){'use strict';this._clickOnEnterTarget=input_id;if(!this._clickOnEnterListener)this._clickOnEnterListener=require('Event').listen(this._nodes.body,'keypress',function(event){var target=event.getTarget();if(target&&target.id===this._clickOnEnterTarget)if(require('Event').getKeyCode(event)==require('Keys').RETURN){this._handleButton(button);event.kill();}return true;}.bind(this));return this;};Dialog.prototype.setStackable=function(stackable,shown){'use strict';this._is_stackable=stackable;this._shown_while_stacked=stackable&&shown;return this;};Dialog.prototype.setHandler=function(handler){'use strict';this._handler=handler;return this;};Dialog.prototype.setCancelHandler=function(cancelHandler){'use strict';this._cancelHandler=Dialog.call_or_eval.bind(null,this,cancelHandler);return this;};Dialog.prototype.setCloseHandler=function(close_handler){'use strict';this._close_handler=Dialog.call_or_eval.bind(null,this,close_handler);return this;};Dialog.prototype.clearHandler=function(){'use strict';return this.setHandler(null);};Dialog.prototype.setPostURI=function(post_uri,asynchronous){'use strict';if(asynchronous===undefined)asynchronous=true;if(asynchronous){this.setHandler(this._submitForm.bind(this,'POST',post_uri));}else this.setHandler(function(){require('Form').post(post_uri,this.getFormData());this.hide();}.bind(this));return this;};Dialog.prototype.setGetURI=function(get_uri){'use strict';this.setHandler(this._submitForm.bind(this,'GET',get_uri));return this;};Dialog.prototype.setModal=function(modal){'use strict';this._modal=modal;require('CSS').conditionClass(this._obj,'generic_dialog_modal',modal);return this;};Dialog.prototype.setSemiModal=function(clickout){'use strict';if(clickout){this.setModal(true);this._semiModalListener=require('Event').listen(this._obj,'click',function(e){if(!require('DOM').contains(this._popup,e.getTarget()))this.hide();}.bind(this));}else this._semiModalListener&&this._semiModalListener.remove();this._semi_modal=clickout;return this;};Dialog.prototype.setWideDialog=function(is_wide){'use strict';this._wide_dialog=is_wide;this._updateWidth();return this;};Dialog.prototype.setContentWidth=function(width){'use strict';this._content_width=width;this._updateWidth();return this;};Dialog.prototype.setTitleLoading=function(loading){'use strict';if(loading===undefined)loading=true;var header=require('DOM').find(this._popup,'h2.dialog_title');if(header)require('CSS').conditionClass(header,'loading',loading);return this;};Dialog.prototype.setSecure=function(is_secure){'use strict';require('CSS').conditionClass(this._nodes.title,'secure',is_secure);return this;};Dialog.prototype.setClassName=function(class_name){'use strict';class_name.split(/\s+/).forEach(require('CSS').addClass.bind(require('CSS'),this._obj));return this;};Dialog.prototype.setFadeEnabled=function(enabled){'use strict';this._fade_enabled=enabled;return this;};Dialog.prototype.setFooter=function(footer){'use strict';var node=this._nodes.footer;require('DOM').setContent(node,this._format(footer||''));require('CSS').conditionShow(node,!!footer);return this;};Dialog.prototype.setAutoFocus=function(focus){'use strict';this._auto_focus=focus;return this;};Dialog.prototype.setTop=function(top){'use strict';this._top=top;this._resetDialogObj();return this;};Dialog.prototype.onloadRegister=function(handler){'use strict';require('createArrayFromMixed')(handler).forEach(function(i){if(typeof i=='string')i=new Function(i);this._onload_handlers.push(i.bind(this));}.bind(this));return this;};Dialog.prototype.setAsyncURL=function(url){'use strict';return this.setAsync(new (require('AsyncRequest'))(url));};Dialog.prototype.setAsync=function(async_request){'use strict';var handler=function(response){if(this._async_request!=async_request)return;this._async_request=null;var payload=response.getPayload(),dialog=payload;if(this._loading)this._showing=true;if(typeof dialog=='string'){this.setBody(dialog);}else this._setFromModel(dialog);this._update();}.bind(this),data=async_request.getData();data.__d=1;async_request.setData(data);var orig_handler=async_request.getHandler()||require('emptyFunction');async_request.setHandler(function(response){orig_handler(response);handler(response);});var request=async_request,orig_error_handler=request.getErrorHandler()||require('emptyFunction'),orig_trans_error_handler=request.getTransportErrorHandler()||require('emptyFunction'),handle_error=function(){this._async_request=null;this._loading=false;if(this._showing&&this._shown_while_stacked){this._update();}else this._hide(this._is_stackable);}.bind(this),server_cancel_handler=request.getServerDialogCancelHandler()||handle_error;request.setAllowCrossPageTransition(this._cross_transition).setErrorHandler(function(response){handle_error();orig_error_handler(response);}).setTransportErrorHandler(function(response){handle_error();orig_trans_error_handler(response);}).setServerDialogCancelHandler(server_cancel_handler);async_request.send();this._async_request=async_request;if(this._showing)this.show();return this;};Dialog.prototype._format=function(content){'use strict';if(typeof content=='string'){content=require('HTML')(content);}else content=require('HTML').replaceJSONWrapper(content);if(content instanceof require('HTML'))content.setDeferred(true);return content;};Dialog.prototype._update=function(){'use strict';if(!this._showing)return;if(this._autohide&&!this._async_request&&!this._autohide_timeout)this._autohide_timeout=setTimeout(require('bind')(this,'hide'),this._autohide);require('CSS').removeClass(this._frame,'dialog_loading_shown');this._loading=false;this._renderDialog();this._runOnloads();this._previous_focus=document.activeElement;require('Focus').set(this._frame);};Dialog.prototype._runOnloads=function(){'use strict';for(var i=0;i<this._onload_handlers.length;++i)try{this._onload_handlers[i]();}catch(ex){}this._onload_handlers=[];};Dialog.prototype._updateWidth=function(){'use strict';var dialog_width=2*(Dialog._BORDER_WIDTH+Dialog._HALO_WIDTH);if(this._content_width){dialog_width+=this._content_width;if(!this._full_bleed)dialog_width+=2*Dialog._PADDING_WIDTH;}else if(this._wide_dialog){dialog_width+=Dialog.SIZE.WIDE;}else dialog_width+=Dialog.SIZE.STANDARD;this._popup.style.width=dialog_width+'px';};Dialog.prototype._updateZIndex=function(){'use strict';if(!this._hasSetZIndex&&this._causal_elem){var z_index=require('getOverlayZIndex')(this._causal_elem),node=this._causal_elem;while(!z_index&&(node=require('ContextualThing').getContext(node)))z_index=require('getOverlayZIndex')(node);this._hasSetZIndex=z_index>(this._modal?400:200);require('Style').set(this._obj,'z-index',this._hasSetZIndex?z_index:'');}};Dialog.prototype._renderDialog=function(){'use strict';this._updateZIndex();this._pushOntoStack();this._obj.style.height=null;if(this._obj&&this._obj.style.display){this._obj.style.visibility='hidden';this._obj.style.display='';this.resetDialogPosition();this._obj.style.visibility='';this._obj.dialog=this;}else this.resetDialogPosition();clearInterval(this.active_hiding);this.active_hiding=setInterval(this._activeResize.bind(this),500);this._submit_on_enter=false;if(this._auto_focus){var input=require('Form').getFirstElement(this._content,['input[type="text"]','textarea','input[type="password"]']);if(input){setTimeout(require('Form').focusFirst.bind(this,this._content),0);}else this._submit_on_enter=true;}var bottom=require('Vector').getElementDimensions(this._content).y+require('Vector').getElementPosition(this._content).y;Dialog._bottoms.push(bottom);this._bottom=bottom;Dialog._updateMaxBottom();return this;};Dialog.prototype._buildDialog=function(){'use strict';this._obj=require('DOM').create('div',{className:'generic_dialog',id:this._uniqueID});this._obj.style.display='none';require('DOM').appendContent(document.body,this._obj);if(!this._popup)this._popup=require('DOM').create('div',{className:'generic_dialog_popup'});this._obj.appendChild(this._popup);require('CSS').addClass(this._obj,'pop_dialog');if(require('Locale').isRTL())require('CSS').addClass(this._obj,'pop_dialog_rtl');require('DOM').setContent(this._popup,require('DOM').create('div',{className:'pop_container_advanced'},require('DOM').create('div',{className:'pop_content',id:'pop_content'})));var frame=require('DOM').find(this._popup,'div.pop_content');frame.setAttribute('tabIndex','0');frame.setAttribute('role','alertdialog');this._frame=this._content=frame;var loading=require('DOM').create('div',{className:'dialog_loading'},fbt._("Loading...")),title_inner=require('DOM').create('span'),title=require('DOM').create('h2',{className:'dialog_title hidden_elem',id:'title_'+this._uniqueID},title_inner),summary=require('DOM').create('div',{className:'dialog_summary hidden_elem'}),body=require('DOM').create('div',{className:'dialog_body'}),buttons=require('DOM').create('div',{className:'rfloat mlm'}),button_message=require('DOM').create('div',{className:'dialog_buttons_msg'}),button_wrapper=require('DOM').create('div',{className:'dialog_buttons clearfix hidden_elem'},[buttons,button_message]),footer=require('DOM').create('div',{className:'dialog_footer hidden_elem'}),content=require('DOM').create('div',{className:'dialog_content'},[summary,body,button_wrapper,footer]);this._nodes={summary:summary,body:body,buttons:buttons,button_message:button_message,button_wrapper:button_wrapper,footer:footer,content:content,title:title,title_inner:title_inner};require('DOM').setContent(this._frame,[title,content,loading]);};Dialog.prototype._activeResize=function(){'use strict';if(this.last_offset_height!=this._content.offsetHeight){this.last_offset_height=this._content.offsetHeight;this.resetDialogPosition();}};Dialog.prototype.resetDialogPosition=function(){'use strict';if(!this._popup)return;this._resetDialogObj();};Dialog.prototype._resetDialogObj=function(){'use strict';var total_margin=2*Dialog._PAGE_MARGIN,viewport_dimensions=require('Vector').getViewportDimensions(),viewport_width=viewport_dimensions.x-total_margin,viewport_height=viewport_dimensions.y-total_margin,total_halo_width=2*Dialog._HALO_WIDTH,content_dimensions=require('Vector').getElementDimensions(this._content),content_width=content_dimensions.x+total_halo_width,content_height=content_dimensions.y+total_halo_width,top=this._top,empty_horiz_space=viewport_width-content_width,empty_vertical_space=viewport_height-content_height;if(empty_vertical_space<0){top=Dialog._PAGE_MARGIN;}else if(top>empty_vertical_space)top=Dialog._PAGE_MARGIN+Math.max(empty_vertical_space,0)/2;var is_fixed=_supportsPositionFixed2();if(!is_fixed)top+=require('Vector').getScrollPosition().y;require('Style').set(this._popup,'marginTop',top+'px');var scroll=is_fixed&&(empty_horiz_space<0||empty_vertical_space<0);require('CSS').conditionClass(this._obj,'generic_dialog_fixed_overflow',scroll);require('CSS').conditionClass(document.documentElement,'generic_dialog_overflow_mode',scroll);};Dialog.prototype._fadeOut=function(temporary){'use strict';if(!this._popup)return;try{new (require('Animation'))(this._obj).duration(0).checkpoint().to('opacity',0).hide().duration(250).ondone(this._hide.bind(this,temporary)).go();}catch(e){this._hide(temporary);}};Dialog.prototype._hide=function(temporary){'use strict';if(this._obj)this._obj.style.display='none';require('CSS').removeClass(document.documentElement,'generic_dialog_overflow_mode');clearInterval(this.active_hiding);if(this._bottom){var bs=Dialog._bottoms;bs.splice(bs.indexOf(this._bottom),1);Dialog._updateMaxBottom();}if(this._previous_focus&&document.activeElement&&require('DOM').contains(this._obj,document.activeElement))require('Focus').set(this._previous_focus);if(temporary)return;this.destroy();};Dialog.prototype.destroy=function(){'use strict';this._popFromStack();clearInterval(this.active_hiding);if(this._obj){require('DOM').remove(this._obj);this._obj=null;}this._clickOnEnterListener&&this._clickOnEnterListener.remove();if(this._close_handler)this._close_handler({return_data:this._return_data});};Dialog.prototype._handleButton=function(button){'use strict';if(typeof button=='string')button=Dialog._findButton(this._buttons,button);var value=Dialog.call_or_eval(button,button.handler);if(value===false)return;if(button.name=='cancel'){this.cancel();}else if(Dialog.call_or_eval(this,this._handler,{button:button})!==false)this.hide();};Dialog.prototype._submitForm=function(method,uri,button){'use strict';var data=this.getFormData();if(button)data[button.name]=button.name;if(this._extra_data)Object.assign(data,this._extra_data);var async_request=new (require('AsyncRequest'))().setURI(uri).setData(data).setMethod(method).setNectarModuleDataSafe(this._causal_elem).setReadOnly(method=='GET');this.setAsync(async_request);return false;};Dialog.prototype._setFromModel=function(original_model){'use strict';var model={};Object.assign(model,original_model);for(var propertyName in model){if(propertyName=='onloadRegister'){this.onloadRegister(model[propertyName]);continue;}var mutator=this['set'+propertyName.substr(0,1).toUpperCase()+propertyName.substr(1)];mutator.apply(this,require('createArrayFromMixed')(model[propertyName]));}};Dialog.prototype._updateBottom=function(){'use strict';var bottom=require('Vector').getElementDimensions(this._content).y+require('Vector').getElementPosition(this._content).y;Dialog._bottoms[Dialog._bottoms.length-1]=bottom;Dialog._updateMaxBottom();};Dialog.prototype._pushOntoStack=function(){'use strict';var stack=Dialog._stack;if(!stack.length)require('Arbiter').inform('layer_shown',{type:'Dialog'});require('removeFromArray')(stack,this);stack.push(this);for(var i=stack.length-2;i>=0;i--){var prev_dialog=stack[i];if(!prev_dialog._is_stackable&&!prev_dialog._async_request){prev_dialog._hide();}else if(!prev_dialog._shown_while_stacked)prev_dialog._hide(true);}};Dialog.prototype._popFromStack=function(){'use strict';var stack=Dialog._stack,was_top=stack[stack.length-1]===this;require('removeFromArray')(stack,this);if(stack.length){if(was_top)stack[stack.length-1].show();}else require('Arbiter').inform('layer_hidden',{type:'Dialog'});};Dialog._updateMaxBottom=function(){'use strict';Dialog.max_bottom=Math.max.apply(Math,Dialog._bottoms);};Dialog.newButton=function(name,label,className,handler){'use strict';var button={name:name,label:label};if(className)button.className=className;if(handler)button.handler=handler;return button;};Dialog.getCurrent=function(){'use strict';var stack=Dialog._stack;return stack.length?stack[stack.length-1]:null;};Dialog.hideCurrent=function(){'use strict';var dialog=Dialog.getCurrent();dialog&&dialog.hide();};Dialog.bootstrap=function(uri,data,read_only,method,model,elem){'use strict';data=data||{};Object.assign(data,new (require('URI'))(uri).getQueryData());method=method||(read_only?'GET':'POST');var status_elem=require('Parent').byClass(elem,'stat_elem')||elem;if(status_elem&&require('CSS').hasClass(status_elem,'async_saving'))return false;var request=new (require('AsyncRequest'))().setReadOnly(!!read_only).setMethod(method).setRelativeTo(elem).setStatusElement(status_elem).setURI(uri).setNectarModuleDataSafe(elem).setData(data),dialog=new Dialog(model).setCausalElement(elem).setAsync(request);dialog.show();return false;};Dialog.showFromModel=function(model,causal_element){'use strict';var dialog=new Dialog(model).setCausalElement(causal_element).show();if(model.hiding)dialog.hide();};Dialog._init=function(){'use strict';this._init=require('emptyFunction');require('Run').onLeave(require('shield')(Dialog._tearDown,null,false));require('Arbiter').subscribe('page_transition',require('shield')(Dialog._tearDown,null,true));require('Event').listen(document.documentElement,'keydown',function(event){if(require('Event').getKeyCode(event)==require('Keys').ESC&&!event.getModifiers().any){if(Dialog._escape())event.kill();}else if(require('Event').getKeyCode(event)==require('Keys').RETURN&&!event.getModifiers().any)if(Dialog._enter())event.kill();});require('Event').listen(window,'resize',function(event){var dialog=Dialog.getCurrent();dialog&&dialog._resetDialogObj();});};Dialog._findButton=function(buttons,name){'use strict';if(buttons)for(var i=0;i<buttons.length;++i)if(buttons[i].name==name)return buttons[i];return null;};Dialog._tearDown=function(is_page_transition){'use strict';var stack=Dialog._stack.slice();for(var ii=stack.length-1;ii>=0;ii--)if(is_page_transition&&!stack[ii]._cross_transition||!is_page_transition&&!stack[ii]._cross_quickling)stack[ii].hide();};Dialog._escape=function(){'use strict';var dialog=Dialog.getCurrent();if(!dialog)return false;var semi_modal=dialog._semi_modal,buttons=dialog._buttons;if(!buttons.length&&!semi_modal)return false;if(semi_modal&&!buttons.length){dialog.hide();return true;}var button_to_simulate,cancel_button=Dialog._findButton(buttons,'cancel');if(dialog._cancelHandler){dialog.cancel();return true;}else if(cancel_button){button_to_simulate=cancel_button;}else if(buttons.length==1){button_to_simulate=buttons[0];}else return false;dialog._handleButton(button_to_simulate);return true;};Dialog._enter=function(){'use strict';var dialog=Dialog.getCurrent();if(!dialog||!dialog._submit_on_enter)return false;if(document.activeElement!=dialog._frame)return false;var buttons=dialog._buttons;if(!buttons)return false;dialog._handleButton(buttons[0]);return true;};Dialog.call_or_eval=function(obj,func,args){'use strict';if(!func)return undefined;args=args||{};if(typeof func=='string'){var params=Object.keys(args).join(', ');func=eval('({f: function('+params+') { '+func+'}})').f;}return func.apply(obj,require('getObjectValues')(args));};Object.assign(Dialog,{OK:{name:'ok',label:fbt._("OK")},CANCEL:{name:'cancel',label:fbt._("Cancel"),className:'inputaux'},CLOSE:{name:'close',label:fbt._("Close")},NEXT:{name:'next',label:fbt._("Next")},SAVE:{name:'save',label:fbt._("Save")},SUBMIT:{name:'submit',label:fbt._("Submit")},CONFIRM:{name:'confirm',label:fbt._("Confirm")},DELETE:{name:'delete',label:fbt._("Delete")},_globalCount:0,_bottoms:[0],max_bottom:0});Object.assign(Dialog,{OK_AND_CANCEL:[Dialog.OK,Dialog.CANCEL],_STANDARD_BUTTONS:[Dialog.OK,Dialog.CANCEL,Dialog.CLOSE,Dialog.SAVE,Dialog.SUBMIT,Dialog.CONFIRM,Dialog.DELETE],SIZE:{WIDE:555,STANDARD:445},_HALO_WIDTH:10,_BORDER_WIDTH:1,_PADDING_WIDTH:10,_PAGE_MARGIN:40,_stack:[]});Object.assign(Dialog.prototype,{_cross_quickling:false,_cross_transition:false,_loading:false,_showing:false});module.exports=Dialog;global.Dialog=Dialog;}),null);
__d("XGroupCallIncomingDialogController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/incoming\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},caller_id:{type:"FBID",required:true},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String",required:true},__asyncDialog:{type:"Int"}});}),null);
__d("XIncomingCallDialogController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/incoming\/",{user_id:{type:"Int",required:true},call_id:{type:"Int"},dialog_type:{type:"String",defaultValue:"VIDEO"},__asyncDialog:{type:"Int"}});}),null);
__d('FBRTCGroupCallIncomingDialog',['AsyncDialog','AsyncRequest','Dialog','EventEmitter','FBRTCSoundController','FBRTCConstants','RTCUtils','XGroupCallIncomingDialogController','XIncomingCallDialogController','randomInt','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('FBRTCConstants').IncomingCallDialogTypes,k=70000;h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;function l(m,n,o,p,q,r){i.constructor.call(this);this.$FBRTCGroupCallIncomingDialog1=m;this.$FBRTCGroupCallIncomingDialog2=n;this.$FBRTCGroupCallIncomingDialog3=o;this.$FBRTCGroupCallIncomingDialog4=p;this.$FBRTCGroupCallIncomingDialog5=q;this.$FBRTCGroupCallIncomingDialog6=r;this.$FBRTCGroupCallIncomingDialog7=null;this.$FBRTCGroupCallIncomingDialog8=null;this.$FBRTCGroupCallIncomingDialog9=null;}l.prototype.serverInfoData=function(){return this.$FBRTCGroupCallIncomingDialog6;};l.prototype.showIncomingDialog=function(){var m=c('Dialog').getCurrent();if(m)m.hide();var n=this.$FBRTCGroupCallIncomingDialog5?j.VIDEO:j.AUDIO,o=c('RTCUtils').isGroupCall(this.$FBRTCGroupCallIncomingDialog1)?c('XGroupCallIncomingDialogController').getURIBuilder().setString('conference_name',this.$FBRTCGroupCallIncomingDialog1).setInt('call_id',this.$FBRTCGroupCallIncomingDialog2).setFBID('caller_id',this.$FBRTCGroupCallIncomingDialog3).setFBIDSet('users_to_ring',this.$FBRTCGroupCallIncomingDialog4).setBool('has_video',this.$FBRTCGroupCallIncomingDialog5).setString('server_info_data',this.$FBRTCGroupCallIncomingDialog6).getURI():c('XIncomingCallDialogController').getURIBuilder().setInt('user_id',this.$FBRTCGroupCallIncomingDialog3).setInt('call_id',this.$FBRTCGroupCallIncomingDialog2).setString('dialog_type',n).getURI();this.$FBRTCGroupCallIncomingDialog7=new (c('AsyncRequest'))(o);c('AsyncDialog').send(this.$FBRTCGroupCallIncomingDialog7,this.$FBRTCGroupCallIncomingDialog10.bind(this));};l.prototype.$FBRTCGroupCallIncomingDialog10=function(m){if(!this.$FBRTCGroupCallIncomingDialog7){setTimeout(function(){m.hide();},1);return;}this.$FBRTCGroupCallIncomingDialog7=null;this.$FBRTCGroupCallIncomingDialog8=m;m.subscribe('confirm',this.$FBRTCGroupCallIncomingDialog11.bind(this));m.subscribe('cancel',this.$FBRTCGroupCallIncomingDialog12.bind(this));var n=this.$FBRTCGroupCallIncomingDialog1+c('randomInt')(0,4294967295).toString();c('FBRTCSoundController').playIncomingRingtone(n,this.$FBRTCGroupCallIncomingDialog1,true);this.$FBRTCGroupCallIncomingDialog9=c('setTimeoutAcrossTransitions')(this.$FBRTCGroupCallIncomingDialog13.bind(this),k);};l.prototype.cancel=function(){if(this.$FBRTCGroupCallIncomingDialog7){this.$FBRTCGroupCallIncomingDialog7.abort();this.$FBRTCGroupCallIncomingDialog7=null;}if(this.$FBRTCGroupCallIncomingDialog9)clearTimeout(this.$FBRTCGroupCallIncomingDialog9);if(this.$FBRTCGroupCallIncomingDialog8){this.$FBRTCGroupCallIncomingDialog8.hide();this.$FBRTCGroupCallIncomingDialog8=null;}c('FBRTCSoundController').stopIncomingRingtone();};l.prototype.$FBRTCGroupCallIncomingDialog11=function(m,n){this.cancel();this.emit('answerCall',this.$FBRTCGroupCallIncomingDialog1,n.value);};l.prototype.$FBRTCGroupCallIncomingDialog12=function(){this.cancel();this.emit('ignoreCall');};l.prototype.$FBRTCGroupCallIncomingDialog13=function(){this.cancel();this.emit('timeout');};f.exports=l;}),null);
__d('FBRTCMultiwayMessage',['CurrentUser','ChannelManager','RTCUtils','MultiwayTypes'],(function a(b,c,d,e,f,g){var h=c('MultiwayTypes').MessageType;c('ChannelManager').startChannelManager();function i(j){'use strict';this.$FBRTCMultiwayMessage1=j;}i.prototype.isRequest=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.responseStatusCode==null;};i.prototype.isType=function(j){'use strict';return this.header().type==j;};i.prototype.transactionId=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.transactionId;};i.prototype.conferenceName=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.conferenceName;};i.prototype.serverInfoData=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.serverInfoData;};i.prototype.message=function(){'use strict';return this.$FBRTCMultiwayMessage1;};i.prototype.endpoint=function(){'use strict';return this.$FBRTCMultiwayMessage1.endpoint;};i.prototype.header=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header;};i.prototype.body=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.body;};i.prototype.incrementRetryCount=function(){'use strict';this.$FBRTCMultiwayMessage1.jsonPayload.header.retryCount++;};i.prototype.ringRequest=function(){'use strict';return this.isRequest()&&this.isType(h.RING)?this.body().ringRequest:null;};i.prototype.dismissRequest=function(){'use strict';return this.isRequest()&&this.isType(h.DISMISS)?this.body().dismissRequest:null;};i.prototype.serverMediaUpdateRequest=function(){'use strict';return this.isRequest()&&this.isType(h.SERVER_MEDIA_UPDATE)?this.body().serverMediaUpdateRequest:null;};i.prototype.conferenceStateRequest=function(){'use strict';return this.isRequest()&&this.isType(h.CONFERENCE_STATE)?this.body().conferenceStateRequest:null;};i.prototype.createResponse=function(j,k){'use strict';var l={endpoint:{appId:'229895473858072',deviceId:c('ChannelManager').getCompleteConfig().sessionID,userId:c('CurrentUser').getID()},jsonPayload:{header:c('RTCUtils').createResponseHeader(this.header(),j),body:k||{}}};return new i(l);};f.exports=i;}),null);
__d("XGroupCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/sendmessage\/",{webrtc_fbtrace:{type:"Int"}});}),null);
__d('RTCMessageSender',['Promise','CurrentUser','XGroupCallSendMessageController','SiteData','Fbtrace','AsyncRequest'],(function a(b,c,d,e,f,g){var h=6000;function i(){'use strict';}i.prototype.send=function(j){'use strict';return new (c('Promise'))(function(k,l){var m=j.jsonPayload.header.conferenceName,n={conference_name:m,user_id:c('CurrentUser').getID(),message:j,app_id:256281040558,app_version:String(c('SiteData').revision||'dev'),op:'RTCMessageSender.send',policy:'WebRTC'},o=c('Fbtrace').requestReceive('browser',String(c('SiteData').revision||'dev'),n),p=c('XGroupCallSendMessageController').getURIBuilder().setInt('webrtc_fbtrace',o.isOn()?1:0).getURI();c('Fbtrace').withDefaultNode(o,function(){var q=new (c('AsyncRequest'))(p).setMethod('POST').setData({message:JSON.stringify(j)}).setAllowCrossPageTransition(true).setHandler(function(r){k(r);}).setErrorHandler(function(r){var s=Error(r.getErrorDescription?r.getErrorDescription():'AsyncRequest error');l(s);}).setTimeoutHandler(h,function(){l('Timeout');});q.send();});});};f.exports=i;}),null);
__d('FBRTCTransactions',['Promise','Map','RTCMessageSender'],(function a(b,c,d,e,f,g){'use strict';var h=60000,i={INIT:0,PROCESSING:1,COMPLETED:2,TERMINATED:3};function j(){this.$FBRTCTransactionOwner1=new (c('Map'))();}j.prototype.findTransaction=function(l){return this.$FBRTCTransactionOwner1.get(l);};j.prototype.addTransaction=function(l){this.$FBRTCTransactionOwner1.set(l.id,l);};j.prototype.removeTransaction=function(l){this.$FBRTCTransactionOwner1['delete'](l.id);};j.prototype.getTransaction=function(l){return this.findTransaction(l.transactionId())||new k(this,l);};function k(l,m){this.id=m.transactionId();this.$FBRTCServerTransaction1=i.INIT;this.$FBRTCServerTransaction2=m;this.$FBRTCServerTransaction3=null;this.$FBRTCServerTransaction4=l;this.$FBRTCServerTransaction5=new Error('Unknown');this.$FBRTCServerTransaction6=null;this.$FBRTCServerTransaction7=new (c('RTCMessageSender'))();this.$FBRTCServerTransaction8();this.$FBRTCServerTransaction4.addTransaction(this);}k.prototype.start=function(){if(this.$FBRTCServerTransaction1==i.INIT){this.$FBRTCServerTransaction9(i.PROCESSING);return c('Promise').resolve(this.$FBRTCServerTransaction2);}else if(this.$FBRTCServerTransaction1==i.PROCESSING){return c('Promise').resolve(null);}else if(this.$FBRTCServerTransaction1==i.COMPLETED){this.$FBRTCServerTransaction10();return c('Promise').resolve(null);}return c('Promise').reject(this.$FBRTCServerTransaction5);};k.prototype.sendResponse=function(l){this.$FBRTCServerTransaction3=l;this.$FBRTCServerTransaction9(i.COMPLETED);this.$FBRTCServerTransaction7.send(l.message()).then(function(m){},function(m){this.$FBRTCServerTransaction5=m;this.$FBRTCServerTransaction9(i.TERMINATED);}.bind(this)).done();};k.prototype.$FBRTCServerTransaction10=function(){if(this.$FBRTCServerTransaction3!=null){var l=this.$FBRTCServerTransaction3;l.incrementRetryCount();this.sendResponse(l);}};k.prototype.$FBRTCServerTransaction9=function(l){if(l!=this.$FBRTCServerTransaction1){this.$FBRTCServerTransaction1=l;if(this.$FBRTCServerTransaction1!=i.TERMINATED)this.$FBRTCServerTransaction8();if(this.$FBRTCServerTransaction1==i.TERMINATED){this.$FBRTCServerTransaction5=new Error('Terminated');this.$FBRTCServerTransaction4.removeTransaction(this);}}};k.prototype.$FBRTCServerTransaction8=function(){if(this.$FBRTCServerTransaction6){clearTimeout(this.$FBRTCServerTransaction6);this.$FBRTCServerTransaction6=null;}this.$FBRTCServerTransaction6=setTimeout(function(){this.$FBRTCServerTransaction9(i.TERMINATED);}.bind(this),h);};f.exports={FBRTCTransactionOwner:j,FBRTCServerTransaction:k};}),null);
__d('RTCGroupCallDialogController',['DOM','FBRTCGroupCallVideoEscalationDialog.react','immutable','RTCGroupCallAddGroupMembersDialog.react','RTCGroupCallAddMembersDialog.react','React','ReactDOM','RTCConfig'],(function a(b,c,d,e,f,g){'use strict';var h={_container:c('DOM').create('div'),showAddGroupMembersDialog:function i(j,k,l,m){c('ReactDOM').render(c('RTCConfig').RtcAddNewParticipantsGK?c('React').createElement(c('RTCGroupCallAddMembersDialog.react'),{participants:j,participantStates:k,thread:l,viewerID:m,onUnmount:function(){return this._onUnmount();}.bind(this)}):c('React').createElement(c('RTCGroupCallAddGroupMembersDialog.react'),{participants:j,participantStates:k,thread:l,viewerID:m,onUnmount:function(){return this._onUnmount();}.bind(this)}),this._container);},showVideoEscalationDialog:function i(j,k){c('ReactDOM').render(c('React').createElement(c('FBRTCGroupCallVideoEscalationDialog.react'),{userName:j,onToggle:function(){this._onUnmount();k();}.bind(this)}),this._container);},_onUnmount:function i(){c('ReactDOM').unmountComponentAtNode(this._container);}};f.exports=h;}),null);
__d('RTCConferenceState',[],(function a(b,c,d,e,f,g){'use strict';var h={NEW:'NEW',AWAITING_USER_START:'AWAITING_USER_START',CONNECTING:'CONNECTING',CONNECTED:'CONNECTED',TERMINATING:'TERMINATING',TERMINATED:'TERMINATED'};f.exports=h;}),null);
__d('FBRTCCallSummaryReducer',['FBRTCCallSummaryStore','FBRTCLogger','MultiwayTypes','RTCCallStore','RTCConferenceState','RTCGroupCallActionTypes','RTCUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCLogger').Key,i=c('MultiwayTypes').ParticipantCallState,j={setCallSummary:function k(l,m){switch(m.type){case c('RTCGroupCallActionTypes').SET_CALL_SUMMARY:return l.set('callSummary',m.callSummary);}return l;},setMWCallType:function k(l,m){switch(m.type){case c('RTCGroupCallActionTypes').SET_MW_CALL_TYPE:l.callSummary.setCallType(m.callType);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;}return l;},onCallStarted:function k(l,m){switch(m.type){case c('RTCGroupCallActionTypes').CALL_SUCCESS:var n=function o(){var p=c('RTCCallStore').getState().callInfo.conferenceState;if(p!==c('RTCConferenceState').TERMINATED){l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());setTimeout(o,10000);}};n();return l;}return l;},onMessageSignaling:function k(l,m){switch(m.type){case c('RTCGroupCallActionTypes').ON_JOIN_REQUEST_SENT:if(l.callSummary.isCaller()){l.callSummary.setOfferSentTime();}else l.callSummary.setAnswerSentTime();l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;case c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE:if(!l.callSummary.isCaller()){l.callSummary.onCallConnected();l.callSummary.onNetworkReady();l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());}l.callSummary.setServerInfoData(m.serverInfoData);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;case c('RTCGroupCallActionTypes').ON_SERVER_MEDIA_UPDATE_SUCCESS:if(l.callSummary.isCaller()){l.callSummary.setAnswerReceivedTime();if(l.callSummary.isNetworkReady())l.callSummary.onCallConnected();l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());}return l;case c('RTCGroupCallActionTypes').ON_CONFERENCE_STATE:var n=c('RTCCallStore').getState().callInfo.conferenceName;if(c('RTCUtils').isGroupCall(n)){l.callSummary.onNetworkReady();l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());}var o=m.request.conferenceStateRequest(),p=o.participantStates;Object.keys(p).forEach(function(q){if(q!==c('RTCCallStore').getState().localUser.getUserID())switch(p[q].state){case i.UNKNOWN:case i.CONTACTING:case i.UNREACHABLE:return;case i.CONNECTED:l.callSummary.onNetworkReady();if(l.callSummary.isAnswerReceived())l.callSummary.onCallConnected();default:if(l.callSummary.isCaller())l.callSummary.setOfferAckReceivedTime();l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());}});return l;}return l;},onCallEnded:function k(l,m){switch(m.type){case c('RTCGroupCallActionTypes').CALL_ERROR:case c('RTCGroupCallActionTypes').HANGUP:case c('RTCGroupCallActionTypes').END_CALL:l.callSummary.onCallEnded(m.endCallReason,false,false,m.endCallSubreason);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;case c('RTCGroupCallActionTypes').DISMISS:l.callSummary.onCallEnded(m.endCallReason,true,false,m.endCallSubreason);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;}return l;},onSurveyResult:function k(l,m){switch(m.type){case c('RTCGroupCallActionTypes').RATING_SHOWN:l.callSummary.addExtraInfo(h.RATING_SHOWN,'1');l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;case c('RTCGroupCallActionTypes').FEEDBACK_SHOWN:l.callSummary.addExtraInfo(h.SURVEY_SHOWN,'1');l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;case c('RTCGroupCallActionTypes').SUBMIT_RATING:l.callSummary.addExtraInfo(h.RATING,m.rating);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;case c('RTCGroupCallActionTypes').SUBMIT_FEEDBACK:l.callSummary.addExtraInfo(h.SURVEY_DETAILS,m.feedback);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;}return l;}};f.exports=j;}),null);
__d('RTCCallControlReducer',['RTCGroupCallActionTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){switch(j.type){case c('RTCGroupCallActionTypes').AUDIO_MUTED:case c('RTCGroupCallActionTypes').AUDIO_UNMUTED:return i.set('localUser',i.localUser.toggleMuteAudio());case c('RTCGroupCallActionTypes').VIDEO_MUTED:case c('RTCGroupCallActionTypes').VIDEO_UNMUTED:return i.set('localUser',i.localUser.toggleMuteVideo());}return i;}f.exports={toggleLocalStream:h};}),null);
__d('RTCUser',['immutable','MultiwayTypes','URI'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').ParticipantCallState;function i(j){var k=j.FBID,l=j.streams,m=l===undefined?c('immutable').Set():l,n=j.screenStreams,o=n===undefined?c('immutable').Set():n,p=j.profileUrl,q=j.profilePictureUrl,r=j.isMessengerUser,s=r===undefined?false:r,t=j.userName,u=t===undefined?'':t,v=j.userShortName,w=v===undefined?'':v,x=j.participantState,y=j.lastConnectedAt,z=y===undefined?Number.MAX_SAFE_INTEGER:y;Object.assign(this,{FBID:k,streams:m,screenStreams:o,profileUrl:p,profilePictureUrl:q,isMessengerUser:s,userName:u,userShortName:w,participantState:x,lastConnectedAt:z});Object.freeze(this);}i.prototype.clone=function(){return new i(babelHelpers['extends']({},this));};i.prototype.getUserID=function(){return this.FBID;};i.prototype.getProfileUrl=function(){return this.profileUrl;};i.prototype.setProfilePictureUrl=function(j){return j!==this.profilePictureUrl?new i(babelHelpers['extends']({},this,{profilePictureUrl:j})):this;};i.prototype.getProfilePictureUrl=function(){return this.profilePictureUrl;};i.prototype.setIsMessengerUser=function(j){return j!==this.isMessengerUser?new i(babelHelpers['extends']({},this,{isMessengerUser:j})):this;};i.prototype.getIsMessengerUser=function(){return this.isMessengerUser;};i.prototype.getUserName=function(){return this.userName;};i.prototype.getUserShortName=function(){return this.userShortName;};i.prototype.setParticipantState=function(j){if((!this.participantState||this.participantState.state!==h.CONNECTED)&&j.state===h.CONNECTED)return new i(babelHelpers['extends']({},this,{participantState:j,lastConnectedAt:Date.now()}));return new i(babelHelpers['extends']({},this,{participantState:j}));};i.prototype.getParticipantState=function(){return this.participantState;};i.prototype.getLastConnectedAt=function(){return this.lastConnectedAt;};i.prototype.hasAudio=function(){return this.streams.some(function(j){return j.getAudioTracks().length>0;});};i.prototype.hasVideo=function(){return this.streams.some(function(j){return j.getVideoTracks().length>0;});};i.prototype.isAudioMuted=function(){if(!this.hasAudio())return true;return this.streams.every(function(j){return this.areAllTracksMuted(j.getAudioTracks());}.bind(this));};i.prototype.isVideoMuted=function(){if(!this.hasVideo())return true;return this.streams.every(function(j){return this.areAllTracksMuted(j.getVideoTracks());}.bind(this));};i.prototype.areAllTracksMuted=function(j){return !j.some(function(k){return k.enabled;});};i.prototype.isTrackMuted=function(j){return this.streams.some(function(k){var l=k.getTrackById(j);if(!l)return true;return !l.enabled;});};i.prototype.toggleMuteAudio=function(j){this.streams.forEach(function(k){return this.$RTCUser1(k.getAudioTracks(),j);}.bind(this));return this.clone();};i.prototype.toggleMuteVideo=function(j){this.streams.forEach(function(k){return this.$RTCUser1(k.getVideoTracks(),j);}.bind(this));return this.clone();};i.prototype.hasStream=function(){return !this.streams.isEmpty();};i.prototype.getStreams=function(){return this.streams;};i.prototype.addStream=function(j){var k=this.streams.add(j);return k!==this.streams?new i(babelHelpers['extends']({},this,{streams:k})):this;};i.prototype.removeStream=function(j){var k=this.streams['delete'](j);return k!==this.streams?new i(babelHelpers['extends']({},this,{streams:k})):this;};i.prototype.removeAllStreams=function(){return this.hasStream()?new i(babelHelpers['extends']({},this,{streams:c('immutable').Set()})):this;};i.prototype.hasScreenStream=function(){return !this.screenStreams.isEmpty();};i.prototype.getScreenStreams=function(){return this.screenStreams;};i.prototype.addScreenStream=function(j){var k=this.screenStreams.add(j);return k!==this.screenStreams?new i(babelHelpers['extends']({},this,{screenStreams:k})):this;};i.prototype.removeScreenStream=function(j){var k=this.screenStreams['delete'](j);return k!==this.screenStreams?new i(babelHelpers['extends']({},this,{screenStreams:k})):this;};i.prototype.removeAllScreenStreams=function(){return this.hasScreenStream()?new i(babelHelpers['extends']({},this,{screenStreams:c('immutable').Set()})):this;};i.prototype.$RTCUser1=function(j,k){var l=k!=null?!k:this.areAllTracksMuted(j);j.forEach(function(m){return m.enabled=l;});};f.exports=i;}),null);
__d('RTCCallReducer',['invariant','immutable','MultiwayTypes','RTCCallActionTypes','RTCConferenceState','RTCGroupCallActionTypes','RTCUser','RTCUtils','URI'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MultiwayTypes').ParticipantCallState,j=c('MultiwayTypes').RtcResponseStatusCode;function k(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').INIT:return aa.set('callInfo',aa.callInfo.set('conferenceName',ba.conferenceName).set('serverInfoData',ba.serverInfoData).set('protocol',ba.protocol));case c('RTCCallActionTypes').RESET:return aa.set('callInfo',aa.callInfo.set('conferenceState',c('RTCConferenceState').NEW).set('conferenceName',ba.conferenceName)).set('callSummary',null).set('connections',new (c('immutable').Set)()).set('remoteUsers',aa.remoteUsers.map(function(ca){return ca.removeAllStreams();}));}return aa;}function l(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').CALL:return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').CONNECTING).set('connections',aa.connections.add(ba.peerConnection));case c('RTCGroupCallActionTypes').CALL_ERROR:return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);case c('RTCGroupCallActionTypes').CALL_SUCCESS:if(ba.connected)return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').CONNECTED);return aa;}return aa;}function m(aa,ba){switch(ba.type){case c('RTCCallActionTypes').INCOMING_CALL_SUCCESS:return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').CONNECTED);}return aa;}function n(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').HANGUP:aa.connections.forEach(function(ca){return ca.close();});return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATING).set('connections',new (c('immutable').Set)()).set('remoteUsers',aa.remoteUsers.map(function(ca){return ca.removeAllStreams();}));case c('RTCGroupCallActionTypes').DISMISS:ba.transaction.sendResponse(ba.request.createResponse(j.OK,{}));case c('RTCGroupCallActionTypes').HANGUP_ERROR:case c('RTCGroupCallActionTypes').HANGUP_SUCCESS:return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);case c('RTCGroupCallActionTypes').END_CALL:return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);}return aa;}function o(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').ON_PARTICIPANTS_ADDED:return aa.set('remoteUsers',aa.remoteUsers.union(Object.keys(ba.participants).map(function(ca){var da=ba.participants[ca];da.fbid||h(0);return new (c('RTCUser'))({FBID:da.fbid,profileUrl:new (c('URI'))(da.href),profilePictureUrl:da.big_image_src,isMessengerUser:!!da.is_messenger_user,userName:da.name,userShortName:da.short_name});})));}return aa;}function p(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').ON_CONFERENCE_STATE:var ca=ba.transaction,da=ba.request,ea=ba.request.conferenceStateRequest();if(ba.conferenceStateVersion>=ea.version){ca.sendResponse(da.createResponse(j.OK,{ConferenceStateResponse:{currentVerison:ba.conferenceStateVersion}}));return aa;}ba.resolve(ea.version);var fa=aa.remoteUsers.map(function(ia){var ja=ea.participantStates[ia.getUserID()];return ja?ia.setParticipantState(ja):ia;}),ga=fa.some(function(ia){var ja=ia.getParticipantState();return ja&&ja.state===i.CONNECTED;}),ha=ga?c('RTCConferenceState').CONNECTED:aa.callInfo.conferenceState;ca.sendResponse(da.createResponse(j.OK,{ConferenceStateResponse:{currentVerison:ba.conferenceStateVersion}}));return aa.setIn(['remoteUsers'],fa).setIn(['callInfo','conferenceState'],ha);}return aa;}function q(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE:return aa.setIn(['callInfo','serverInfoData'],ba.serverInfoData);}return aa;}function r(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').INIT_LOCAL_USER:return aa.set('localUser',ba.localUser);case c('RTCGroupCallActionTypes').INIT_REMOTE_USERS:return aa.set('remoteUsers',ba.remoteUsers);}return aa;}function s(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').ADD_LOCAL_STREAM:return aa.set('localUser',aa.localUser.addStream(ba.stream));case c('RTCGroupCallActionTypes').REMOVE_LOCAL_STREAM:return aa.set('localUser',aa.localUser.removeStream(ba.stream));case c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_STREAMS:if(ba.stopStreams)for(var ca=aa.localUser.getStreams(),da=Array.isArray(ca),ea=0,ca=da?ca:ca[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fa;if(da){if(ea>=ca.length)break;fa=ca[ea++];}else{ea=ca.next();if(ea.done)break;fa=ea.value;}var ga=fa;c('RTCUtils').stopMediaStream(ga);}return aa.set('localUser',aa.localUser.removeAllStreams());}return aa;}function t(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').ADD_LOCAL_SCREEN_STREAM:return aa.set('localUser',aa.localUser.addScreenStream(ba.stream));case c('RTCGroupCallActionTypes').REMOVE_LOCAL_SCREEN_STREAM:return aa.set('localUser',aa.localUser.removeScreenStream(ba.stream));case c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_SCREEN_STREAMS:if(ba.stopStreams)for(var ca=aa.localUser.getScreenStreams(),da=Array.isArray(ca),ea=0,ca=da?ca:ca[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fa;if(da){if(ea>=ca.length)break;fa=ca[ea++];}else{ea=ca.next();if(ea.done)break;fa=ea.value;}var ga=fa;c('RTCUtils').stopMediaStream(ga);}return aa.set('localUser',aa.localUser.removeAllScreenStreams());}return aa;}function u(aa,ba){var ca=void 0;switch(ba.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_STREAM:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.addStream(ba.stream)));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_STREAM:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.removeStream(ba.stream)));case c('RTCGroupCallActionTypes').REMOVE_ALL_REMOTE_STREAMS:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.removeAllStreams().removeAllScreenStreams()));}return aa;}function v(aa,ba){var ca=void 0;switch(ba.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_TRACK:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.clone()));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_TRACK:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.clone()));}return aa;}function w(aa,ba){var ca=void 0;switch(ba.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_SCREEN_STREAM:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.addScreenStream(ba.stream)));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_SCREEN_STREAM:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.removeScreenStream(ba.stream)));}return aa;}function x(aa,ba){var ca=void 0;switch(ba.type){case c('RTCGroupCallActionTypes').TOGGLE_REMOTE_STREAM:return aa.set('remoteUsers',Object.entries(ba.mediaStatus).reduce(function(da,ea){var fa=ea[0],ga=ea[1],ha=da.reduce(function(ka,la){var ma=la.getStreams().map(function(na){return na.getTracks().find(function(oa){return oa.id===fa;});}).find(Boolean);return ma?{user:la,track:ma}:ka;},{}),ia=ha.user,ja=ha.track;if(ia&&ja){if(ja.kind==='audio'&&ia.isAudioMuted()===ga)return da['delete'](ia).add(ia.toggleMuteAudio());if(ja.kind==='video'&&ia.isVideoMuted()===ga)return da['delete'](ia).add(ia.toggleMuteVideo());}return da;},aa.remoteUsers));case c('RTCCallActionTypes').REMOTE_VIDEO_MUTED:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.toggleMuteVideo(true)));case c('RTCCallActionTypes').REMOTE_VIDEO_UNMUTED:ca=y(aa,ba);if(!ca)return aa;return aa.setIn(['remoteUsers'],aa.remoteUsers['delete'](ca).add(ca.toggleMuteVideo(false)));}return aa;}function y(aa,ba){return aa.remoteUsers.find(function(ca){if(ba.userID)return ca.getUserID()==ba.userID;return ca.getUserID()===ba.stream.id.split(':')[0];});}function z(aa,ba){switch(ba.type){case c('RTCGroupCallActionTypes').WAIT_FOR_USER_INPUT:if(aa.callInfo.conferenceState===c('RTCConferenceState').NEW)return aa.setIn(['callInfo','conferenceState'],c('RTCConferenceState').AWAITING_USER_START);return aa;}return aa;}f.exports={callInit:k,callStart:l,callEnd:n,onParticipantsChanged:o,incomingCallStart:m,initUsers:r,processLocalStream:s,processLocalScreenStream:t,processRemoteStream:u,processRemoteScreenStream:w,processRemoteTrack:v,toggleRemoteStream:x,processConferenceState:p,processJoinResponse:q,waitForUserInput:z};}),null);
__d('RTCCallStoreState',['CurrentUser','FBRTCCallSummary','immutable','RTCConferenceState','RTCUser'],(function a(b,c,d,e,f,g){'use strict';var h,i,j,k,l={debugID:0,conferenceState:c('RTCConferenceState').NEW,conferenceName:'',protocol:'',serverInfoData:''};h=babelHelpers.inherits(m,c('immutable').Record(l));i=h&&h.prototype;function m(){h.apply(this,arguments);}var n={connections:c('immutable').Set(),localUser:new (c('RTCUser'))({FBID:c('CurrentUser').getID()}),remoteUsers:c('immutable').Set(),callInfo:new m(),callSummary:null};j=babelHelpers.inherits(o,c('immutable').Record(n));k=j&&j.prototype;function o(){j.apply(this,arguments);}f.exports=o;}),null);
__d('RTCGroupCallDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k);this.dispatch=this.dispatch.bind(this);}f.exports=new j({strict:true});}),null);
__d('RTCCallStore',['FBRTCCallSummaryReducer','FluxReduceStore','RTCCallControlReducer','RTCCallReducer','RTCCallStoreState','RTCGroupCallDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=[c('FBRTCCallSummaryReducer').onCallEnded,c('FBRTCCallSummaryReducer').onCallStarted,c('FBRTCCallSummaryReducer').onMessageSignaling,c('FBRTCCallSummaryReducer').onSurveyResult,c('FBRTCCallSummaryReducer').setCallSummary,c('FBRTCCallSummaryReducer').setMWCallType,c('RTCCallControlReducer').toggleLocalStream,c('RTCCallReducer').callEnd,c('RTCCallReducer').callInit,c('RTCCallReducer').callStart,c('RTCCallReducer').incomingCallStart,c('RTCCallReducer').initUsers,c('RTCCallReducer').onParticipantsChanged,c('RTCCallReducer').processConferenceState,c('RTCCallReducer').processJoinResponse,c('RTCCallReducer').processLocalScreenStream,c('RTCCallReducer').processLocalStream,c('RTCCallReducer').processRemoteScreenStream,c('RTCCallReducer').processRemoteStream,c('RTCCallReducer').processRemoteTrack,c('RTCCallReducer').toggleRemoteStream,c('RTCCallReducer').waitForUserInput];h=babelHelpers.inherits(k,c('FluxReduceStore'));i=h&&h.prototype;k.prototype.getInitialState=function(){return new (c('RTCCallStoreState'))();};k.prototype.reduce=function(l,m){return j.reduce(function(n,o){return o(n,m);},l);};function k(){h.apply(this,arguments);}f.exports=new k(c('RTCGroupCallDispatcher'));}),null);
__d('RTCGroupCallActions',['RTCGroupCallActionTypes','RTCGroupCallDispatcher','RTCUtils'],(function a(b,c,d,e,f,g){'use strict';var h={setMWCallType:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SET_MW_CALL_TYPE,callType:j});},setLayout:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SET_LAYOUT,layout:j});},setDominantSpeaker:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SET_DOMINANT_SPEAKER,dominantSpeakerFBID:j});},initThread:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT_THREAD,thread:j,participants:k});},onParticipantLeft:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_PARTICIPANT_LEFT,participantFBID:j});},onParticipantsAdded:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_PARTICIPANTS_ADDED,participants:j});},addParticipantsToRing:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_PARTICIPANTS_TO_RING,participantFBIDs:j});},toggleRemoteStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').TOGGLE_REMOTE_STREAM,mediaStatus:j});},handleDismissRequest:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').DISMISS,transaction:j,request:k,endCallReason:c('RTCUtils').endCallReasonFromDismissRequest(k.dismissRequest())});},handleConferenceStateRequest:function i(j,k,l,m){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_CONFERENCE_STATE,transaction:j,request:k,conferenceStateVersion:l,resolve:m});},onJoinRequestSent:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_JOIN_REQUEST_SENT});},onJoinResponse:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE,serverInfoData:j});},onServerMediaUpdateSuccess:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_SERVER_MEDIA_UPDATE_SUCCESS});},onClientMediaUpdateResponse:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_CLIENT_MEDIA_UPDATE_RESPONSE,responseStatusCode:j,currentVersion:k});}};f.exports=h;}),null);
__d('RTCMWSessionDescription',['Promise','MultiwayTypes','RTCCallStore','RTCConfig','RTCGroupCallActions','RTCGroupCallDialogController'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').MediaType,i={_videoEnabled:{},serverMediaUpdate:function j(k,l){var m,n=k.fromVersion,o=k.toVersion,p=k.mediaUpdates,q=c('RTCCallStore').getState().connections.first(),r=q.getLocalDescription(),s=q.getRemoteDescription(),t=s.sessionDescription.getVersion();if(t!==n){l(t);return;}var u=function(){p.forEach(function(w){s.processServerMediaUpdate(w);w.media.forEach(function(x){var y=x.type,z=x.enabled;if(y===h.VIDEO)this._videoEnabled[w.sourceKey]=z;}.bind(this));}.bind(this));s.sessionDescription.setVersion(o);c('Promise').all([q.setLocalDescription(r),q.setRemoteDescription(s)]).then(function(){var w;c('RTCGroupCallActions').toggleRemoteStream((w=[]).concat.apply(w,p.map(function(x){var y=x.media;return y;})).reduce(function(x,y){var z=y.id,aa=y.enabled;x[z]=aa;return x;},{}));l(o);},function(){return l(t);})['catch'](function(w){});}.bind(this),v=p.find(function(w){var x=w.sourceKey,y=w.media;return !this._videoEnabled[x]&&y.some(function(z){var aa=z.type,ba=z.enabled;return aa===h.VIDEO&&ba;});}.bind(this));if(c('RTCConfig').RtcConferencingVideoGK&&!c('RTCCallStore').getState().localUser.hasVideo()&&v){(function(){var w=v.sourceKey.split(':'),x=w[0],y=c('RTCCallStore').getState().remoteUsers.find(function(z){return z.getUserID()===x;});c('RTCGroupCallDialogController').showVideoEscalationDialog(y.getUserName(),u);})();}else u();}};f.exports=i;}),null);
__d('RTCCallActions',['RTCCallActionTypes','RTCGroupCallActionTypes','RTCGroupCallDispatcher','RTCUtils','emptyFunction','mixInEventEmitter'],(function a(b,c,d,e,f,g){'use strict';var h={addListener:c('emptyFunction'),emit:c('emptyFunction'),initialize:function i(j,k,l,m,n){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT,conferenceName:k,callID:m,serverInfoData:l,protocol:j,callTrigger:n});},reset:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCCallActionTypes').RESET,conferenceName:j});},setCallSummary:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SET_CALL_SUMMARY,callSummary:j});},call:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL,usersToRing:j,peerConnection:k});},callSuccess:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL_SUCCESS,connected:j});},incomingCallSuccess:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCCallActionTypes').INCOMING_CALL_SUCCESS});},callError:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL_ERROR,endCallReason:c('RTCUtils').endCallReasonFromResponseStatusCode(j),endCallSubreason:'Call error: '+(j||0)});},hangupSuccess:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP_SUCCESS});},hangupError:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP_ERROR,error:j});},join:function i(j){this.call([],j);},hangup:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP,hangupReason:j,detailedReasonString:k,endCallReason:c('RTCUtils').endCallReasonFromHangupReason(j)});},initLocalUser:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT_LOCAL_USER,localUser:j});},initRemoteUsers:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT_REMOTE_USERS,remoteUsers:j});},addLocalStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_LOCAL_STREAM,stream:j});},removeLocalStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_LOCAL_STREAM,stream:j});},removeAllLocalStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_STREAMS,stopStreams:j});},removeAllLocalScreenStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_SCREEN_STREAMS,stopStreams:j});},addRemoteStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_STREAM,stream:j,userID:k});},removeRemoteStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_STREAM,stream:j,userID:k});},removeAllRemoteStreams:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_REMOTE_STREAMS,userID:j});},addRemoteTrack:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_TRACK,stream:j,track:k});},removeRemoteTrack:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_TRACK,stream:j,track:k});},addLocalScreenStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_LOCAL_SCREEN_STREAM,stream:j});},removeLocalScreenStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_LOCAL_SCREEN_STREAM,stream:j});},addRemoteScreenStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_SCREEN_STREAM,stream:j,userID:k});},removeRemoteScreenStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_SCREEN_STREAM,stream:j,userID:k});},endCall:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').END_CALL,endCallReason:j,endCallSubreason:k});},waitForUserInput:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').WAIT_FOR_USER_INPUT});},toggleMuteAudio:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').AUDIO_UNMUTED:c('RTCGroupCallActionTypes').AUDIO_MUTED});},toggleMuteVideo:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').VIDEO_UNMUTED:c('RTCGroupCallActionTypes').VIDEO_MUTED});},toggleMuteRemoteVideo:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCCallActionTypes').REMOTE_VIDEO_MUTED:c('RTCCallActionTypes').REMOTE_VIDEO_UNMUTED,userID:k});},toggleSelfView:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').SELF_VIEW_COLLAPSED:c('RTCGroupCallActionTypes').SELF_VIEW_UNCOLLAPSED});},submitRating:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SUBMIT_RATING,rating:j});},submitFeedback:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SUBMIT_FEEDBACK,feedback:j});},ratingShown:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').RATING_SHOWN});},feedbackShown:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').FEEDBACK_SHOWN});}};c('mixInEventEmitter')(h,{onIceConnectionStateChange:true});f.exports=h;}),null);
__d('RTCMultiwayMessageHandler',['Arbiter','ChannelConstants','FBRTCMultiwayMessage','FBRTCTransactions','RTCCallActions','RTCCallStore','RTCGroupCallActions','RTCMWSessionDescription','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCTransactions').FBRTCServerTransaction,i=c('FBRTCTransactions').FBRTCTransactionOwner,j=c('MultiwayTypes').RtcResponseStatusCode;function k(){this.$RTCMultiwayMessageHandler3=-1;this.$RTCMultiwayMessageHandler5();}k.prototype.initialize=function(l,m){this.$RTCMultiwayMessageHandler1=l;this.$RTCMultiwayMessageHandler2=m;};k.initHandler=function(l,m){new k().initialize(l,m);};k.close=function(){if(k.$RTCMultiwayMessageHandler4){c('Arbiter').unsubscribe(k.$RTCMultiwayMessageHandler4);k.$RTCMultiwayMessageHandler4=null;}};k.prototype.$RTCMultiwayMessageHandler5=function(){k.$RTCMultiwayMessageHandler4=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('rtc_multi_json'),function(l,m){this.$RTCMultiwayMessageHandler6(m.obj);}.bind(this));};k.prototype.$RTCMultiwayMessageHandler6=function(l){var m=new (c('FBRTCMultiwayMessage'))(l);if(!m.isRequest())return;if(this.$RTCMultiwayMessageHandler1===m.conferenceName()){this.$RTCMultiwayMessageHandler7(m);}};k.prototype.$RTCMultiwayMessageHandler7=function(l){var m=new h(new i(),l);m.start().then(function(n){if(n!=null)if(n.dismissRequest()!=null){var o=c('RTCCallStore').getState(),p=o.callInfo,q=o.connections;if(n.serverInfoData()===p.serverInfoData){c('RTCGroupCallActions').handleDismissRequest(m,n);k.close();q.forEach(function(r){return r.close();});c('RTCCallActions').removeAllLocalStreams(true);}}else if(n.serverMediaUpdateRequest()!=null){c('RTCMWSessionDescription').serverMediaUpdate(n.serverMediaUpdateRequest(),function(r){c('RTCGroupCallActions').onServerMediaUpdateSuccess();m.sendResponse(n.createResponse(j.OK,{serverMediaUpdateResponse:{currentVersion:r}}));});}else if(n.conferenceStateRequest()!=null)c('RTCGroupCallActions').handleConferenceStateRequest(m,n,this.$RTCMultiwayMessageHandler3,function(r){this.$RTCMultiwayMessageHandler3=r;}.bind(this));}.bind(this)).done();};f.exports=k;}),null);
__d('FBRTCGroupCallVideoEscalationDialog.react',['fbt','FBRTCConstants','MessengerDialog.react','MessengerDialogBody.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogFooter.react','React','RTCGroupCallActions','RTCMWProtocolHandler'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('FBRTCConstants').CallType,j=function k(l){var m=l.userName,n=l.onToggle;return c('React').createElement(c('MessengerDialog.react'),{onToggle:n},c('React').createElement(c('MessengerDialogBody.react'),null,h._("{name} added video chat. Would you like to share your video?",[h.param('name',m)])),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),{onClick:function o(){return c('RTCGroupCallActions').setMWCallType(i.ESCALATION_DECLINED);}}),c('React').createElement(c('MessengerDialogButton.react'),{label:h._("Share Video"),onClick:function o(){c('RTCMWProtocolHandler').videoEscalation();n();},type:'primary'})));};f.exports=j;}),null);
__d('RTCGroupCallAddGroupMembersDialog.react',['cx','fbt','MessengerDialog.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerRTCGroupCallContactList.react','MessengerRTCGroupCallRingParticipantsRow.react','MessengerRTCGroupCallThreadRow.react','React','RTCCallStore','RTCMWProtocolHandler'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PureComponent,m=460;j=babelHelpers.inherits(n,l);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.state={isParticipantSelected:this.props.participants.mapEntries(function(t){var u=t[0],v=t[1];return [u,false];})},this.$RTCGroupCallAddGroupMembersDialog1=function(){c('RTCMWProtocolHandler').addParticipants(c('RTCCallStore').getState().callInfo.conferenceName,c('RTCCallStore').getState().callInfo.serverInfoData,this.$RTCGroupCallAddGroupMembersDialog2().map(function(t){var u=t.fbid;return u||'';}));this.props.onUnmount();}.bind(this),p;}n.prototype.render=function(){var o=this.props,p=o.participants,q=o.participantStates,r=o.thread,s=o.viewerID;return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.props.onUnmount,type:'default',width:m},c('React').createElement('div',{className:"_1axt"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Add group members")),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ring"),onClick:this.$RTCGroupCallAddGroupMembersDialog1,disabled:this.$RTCGroupCallAddGroupMembersDialog2().length===0,type:'primary'})),c('React').createElement(c('MessengerRTCGroupCallThreadRow.react'),{participants:p,thread:r,viewerID:s}),c('React').createElement(c('MessengerRTCGroupCallRingParticipantsRow.react'),{names:this.$RTCGroupCallAddGroupMembersDialog2().map(function(t){var u=t.name;return u;}).sort(function(t,u){return t.localeCompare(u);})}),c('React').createElement(c('MessengerRTCGroupCallContactList.react'),{participants:p.toArray().sort(function(t,u){return t.name.localeCompare(u.name);}),participantStates:q,isParticipantSelected:this.state.isParticipantSelected,onClick:function(t){return this.setState({isParticipantSelected:this.state.isParticipantSelected.set(t,!this.state.isParticipantSelected.get(t))});}.bind(this)})));};n.prototype.$RTCGroupCallAddGroupMembersDialog2=function(){return this.props.participants.filter(function(o,p){return this.state.isParticipantSelected.get(p);}.bind(this)).toArray();};f.exports=n;}),null);
__d('RTCGroupCallAddMembersDialog.react',['cx','fbt','immutable','MercuryIDs','MercuryLogMessageType','MercuryMessageActions','MercuryMessageObject','MercuryTriodeSourceUtil','MessengerAdminGroupUtils','MessengerDialog.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerGraphQLTokenizer.react','MessengerRTCGroupCallContactList.react','MessengerRTCGroupCallThreadRow.react','React','RTCCallStore','RTCGroupCallActions','RTCMWProtocolHandler'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PureComponent,m=460;j=babelHelpers.inherits(n,l);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.state={isParticipantSelected:this.props.participants.mapEntries(function(t){var u=t[0],v=t[1];return [u,false];}),newParticipants:c('immutable').List()},this.$RTCGroupCallAddMembersDialog1=function(t){this.setState({isParticipantSelected:this.state.isParticipantSelected.set(t,!this.state.isParticipantSelected.get(t))});}.bind(this),this.$RTCGroupCallAddMembersDialog2=function(){this.props.onUnmount();c('RTCGroupCallActions').addParticipantsToRing(this.state.newParticipants.toArray().map(function(t){return t.getUniqueID();}));this.$RTCGroupCallAddMembersDialog7();if(this.$RTCGroupCallAddMembersDialog3().length>0)c('RTCMWProtocolHandler').addParticipants(c('RTCCallStore').getState().callInfo.conferenceName,c('RTCCallStore').getState().callInfo.serverInfoData,this.$RTCGroupCallAddMembersDialog3().map(function(t){var u=t.fbid;return u||'';}));}.bind(this),this.$RTCGroupCallAddMembersDialog4=function(t){this.setState({newParticipants:this.state.newParticipants.push(t)});}.bind(this),this.$RTCGroupCallAddMembersDialog6=function(t){var u=t.getUniqueID(),v=this.state.newParticipants,w=v.findIndex(function(x){return x.getUniqueID()===u;});if(w!==-1)this.setState({newParticipants:v['delete'](w)});}.bind(this),this.$RTCGroupCallAddMembersDialog5=function(){this.setState({newParticipants:c('immutable').List()});}.bind(this),p;}n.prototype.render=function(){var o=this.props,p=o.participants,q=o.participantStates,r=o.thread,s=o.viewerID,t=c('React').createElement('div',null,c('React').createElement('div',{className:"_225b"},i._("Group Members")),c('React').createElement(c('MessengerRTCGroupCallContactList.react'),{isParticipantSelected:this.state.isParticipantSelected,onClick:this.$RTCGroupCallAddMembersDialog1,participants:p.toArray().sort(function(u,v){return u.name.localeCompare(v.name);}),participantStates:q}));return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.props.onUnmount,type:'default',width:m},c('React').createElement('div',{className:"_5zad"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Add group members")),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ring"),onClick:this.$RTCGroupCallAddMembersDialog2,disabled:this.$RTCGroupCallAddMembersDialog3().length+this.state.newParticipants.size===0,type:'primary'})),c('React').createElement(c('MessengerRTCGroupCallThreadRow.react'),{displayAddMemberWarning:true,participants:p,thread:r,viewerID:s}),c('React').createElement(c('MessengerGraphQLTokenizer.react'),{autoFocus:false,context:null,className:"_2el3",defaultEntries:t,enableMessageSearch:false,entries:this.state.newParticipants,excludeGroups:true,excludePages:true,forceHideClearButton:true,hasHoverState:false,hideViewWithEntries:false,onAddEntryAttempt:this.$RTCGroupCallAddMembersDialog4,onClear:this.$RTCGroupCallAddMembersDialog5,onRemoveEntryAttempt:this.$RTCGroupCallAddMembersDialog6,originalEntryIDs:c('immutable').Set(this.props.participants.keySeq().toArray().map(function(u){return c('MercuryIDs').getUserIDFromParticipantID(u)||u;})),placeholder:i._("Add to group:"),showDefaultEntries:true,shouldQueryInternalBot:false,shouldQueryVCEndpoint:false,scrollableViewClassName:"_2el2",useLayer:false,viewer:this.props.viewerID,width:m})));};n.prototype.$RTCGroupCallAddMembersDialog7=function(){if(this.state.newParticipants.size)if(c('MessengerAdminGroupUtils').isJoinableThread(this.props.thread)){this.state.newParticipants.forEach(function(p){var q=c('MercuryIDs').getThreadIDFromUserID(p.getUniqueID());this.$RTCGroupCallAddMembersDialog8().send(this.$RTCGroupCallAddMembersDialog9().constructUserGeneratedMessageObject(this.props.thread.joinable_mode.link,c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),q));}.bind(this));}else{var o='thread:'+(this.props.thread.thread_fbid||this.props.thread.thread_id.split('.')[1]);this.$RTCGroupCallAddMembersDialog8().send(this.$RTCGroupCallAddMembersDialog9().constructLogMessageObject(c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),o,c('MercuryLogMessageType').SUBSCRIBE,{added_participants:this.state.newParticipants.map(function(p){return c('MercuryIDs').getParticipantIDFromUserID(p.getUniqueID());}).toArray()}));}};n.prototype.$RTCGroupCallAddMembersDialog8=function(){return c('MercuryMessageActions').getForFBID(this.props.viewerID);};n.prototype.$RTCGroupCallAddMembersDialog9=function(){return c('MercuryMessageObject').getForFBID(this.props.viewerID);};n.prototype.$RTCGroupCallAddMembersDialog3=function(){return this.props.participants.filter(function(o,p){return this.state.isParticipantSelected.get(p);}.bind(this)).toArray();};f.exports=n;}),null);
__d('RTCIceCandidate',[],(function a(b,c,d,e,f,g){'use strict';f.exports=window.RTCIceCandidate||window.mozRTCPeerConnection;}),null);
__d('RTCPeerConnection',[],(function a(b,c,d,e,f,g){'use strict';f.exports=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;}),null);
__d('RTCSessionDescription',['FBRTCSdpUtils','FBRTCExperiment','MultiwayTypes','FBRTCConstants'],(function a(b,c,d,e,f,g){var h=c('MultiwayTypes').MediaType,i=c('FBRTCConstants').SignalingProtocol,j=window.RTCSessionDescription||window.mozRTCSessionDescription,k=2,l='o',m='m',n='a',o='rtpmap',p='ssrc-group',q='ssrc',r='cname',s='msid',t='mslabel',u='label',v='sendonly',w='recvonly',x='sendrecv',y='inactive',z='offer',aa='answer',ba='=',ca=' ',da=':',ea='\r\n',fa='audio',ga='video',ha=function oa(pa,qa){return pa.startsWith(qa+ba);},ia=function oa(pa){return pa.substr(k);},ja=function oa(pa,qa){return pa.startsWith(qa+ea)||pa.startsWith(qa+da);},ka=function oa(pa,qa){return pa.substr(qa.length+1);};function la(oa){'use strict';this.$SessionDescription1=[];this.$SessionDescription2='-';this.$SessionDescription3='multiway';this.$SessionDescription4=1;this.$SessionDescription5='IN';this.$SessionDescription6='IP4';this.$SessionDescription7='127.0.0.1';oa.forEach(function(pa){if(ha(pa,l)){var qa=ia(pa).split(ca);if(qa.length==6){this.$SessionDescription2=qa[0];this.$SessionDescription3=qa[1];this.$SessionDescription4=parseInt(qa[2],10);this.$SessionDescription5=qa[3];this.$SessionDescription6=qa[4];this.$SessionDescription7=qa[5];}}this.$SessionDescription1.push(pa);}.bind(this));}la.prototype.setVersion=function(oa){'use strict';this.$SessionDescription4=oa;};la.prototype.getVersion=function(){'use strict';return this.$SessionDescription4;};la.prototype.toSdp=function(){'use strict';return this.$SessionDescription1.map(function(oa){if(ha(oa,l)){return l+ba+this.$SessionDescription2+ca+this.$SessionDescription3+ca+this.$SessionDescription4+ca+this.$SessionDescription5+ca+this.$SessionDescription6+ca+this.$SessionDescription7;}else return oa;}.bind(this)).join(ea);};function ma(oa,pa){var qa=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];'use strict';this.$MediaDescription1=[];var ra={},sa=[],ta=[];oa.forEach(function(ua){var va=ia(ua);if(ha(ua,m))this.$MediaDescription4=va.split(ca)[0];if(ha(ua,n)&&ja(va,o)){var wa=ka(va,o),xa=wa.split(ca),ya=xa[0],za=xa[1];ra[za]=ya;}if(ha(ua,n)&&ja(va,q)){this.$MediaDescription6(va,sa);}else if(ha(ua,n)&&ja(va,p)){this.$MediaDescription7(va,ta);}else if(ha(ua,n)&&(va===v||va===w||va===x||va===y)){this.$MediaDescription5=va;}else this.$MediaDescription1.push(ua);}.bind(this));Object.keys(qa).forEach(function(ua){if(ra[ua]){var va=Object.keys(qa[ua]).map(function(wa){return wa+'='+qa[ua][wa];}).join(';');this.$MediaDescription1.push('a=fmtp:'+ra[ua]+' '+va);}}.bind(this));this.$MediaDescription3={};this.$MediaDescription2={};sa.forEach(function(ua){if(Object.prototype.hasOwnProperty.call(ua,r)){var va=ua.cname;if(!this.$MediaDescription3[va]){this.$MediaDescription3[va]=[ua];}else this.$MediaDescription3[va].push(ua);var wa=this.findSsrcGroupForSsrc(ta,ua.ssrc);if(wa){if(!this.$MediaDescription2[va]){this.$MediaDescription2[va]=[wa];}else this.$MediaDescription2[va].push(wa);this.removeSsrcGroup(wa,ta);}}}.bind(this));if(pa===z){if(sa.length===0){this.$MediaDescription5=w;}else this.$MediaDescription5=x;}else if(pa===aa)this.$MediaDescription5=x;}ma.prototype.getMediaType=function(){'use strict';return this.$MediaDescription4;};ma.prototype.findSsrcGroupForSsrc=function(oa,pa){'use strict';return oa.find(function(qa){var ra=qa.ssrcs;return ra.some(function(sa){return sa===pa;});});};ma.prototype.addStreamsForEndpoint=function(oa,pa){'use strict';this.$MediaDescription3[oa]=pa;};ma.prototype.addSsrcGroupsForEndpoint=function(oa,pa){'use strict';this.$MediaDescription3[oa].forEach(function(qa){var ra=qa.ssrc,sa=this.findSsrcGroupForSsrc(pa,ra);if(sa){if(!this.$MediaDescription2[oa]){this.$MediaDescription2[oa]=[sa];}else this.$MediaDescription2[oa].push(sa);this.removeSsrcGroup(sa,pa);}}.bind(this));};ma.prototype.removeSsrcGroup=function(oa,pa){'use strict';var qa=pa.indexOf(oa);if(qa!==-1)pa.splice(qa,1);};ma.prototype.$MediaDescription7=function(oa,pa){'use strict';var qa=ka(oa,p);if(qa){var ra=qa.split(ca),sa=ra[0],ta=ra.slice(1);pa.push({semantics:sa,ssrcs:ta.map(function(ua){return parseInt(ua,10);})});}};ma.prototype.$MediaDescription6=function(oa,pa){'use strict';var qa=oa.indexOf(ca),ra=oa.substr(0,qa),sa=parseInt(ka(ra,q),10),ta=oa.substr(qa+1),ua=pa.find(function(wa){return wa.ssrc===sa;});if(!ua){ua={};ua.ssrc=sa;pa.push(ua);}if(ja(ta,r)){ua.cname=ka(ta,r);}else if(ja(ta,s)){var va=ka(ta,s).split(ca);ua.msid={id:va[0],appdata:va[1]};}else if(ja(ta,t)){ua.mslabel=ka(ta,t);}else if(ja(ta,u))ua.label=ka(ta,u);};ma.prototype.toSdp=function(){'use strict';var oa=[];this.$MediaDescription1.forEach(function(ra){oa.push(ra);});for(var pa in this.$MediaDescription2)this.$MediaDescription2[pa].forEach(function(ra){oa.push(n+ba+p+da+ra.semantics+ca+ra.ssrcs.join(ca));});oa.push(n+ba+this.$MediaDescription5);for(var qa in this.$MediaDescription3)this.$MediaDescription3[qa].forEach(function(ra){if(ra.cname)oa.push(n+ba+q+da+ra.ssrc+ca+r+da+ra.cname);if(ra.msid)oa.push(n+ba+q+da+ra.ssrc+ca+s+da+ra.msid.id+(ra.msid.appdata?ca+ra.msid.appdata:''));if(ra.mslabel)oa.push(n+ba+q+da+ra.ssrc+ca+t+da+ra.mslabel);if(ra.label)oa.push(n+ba+q+da+ra.ssrc+ca+u+da+ra.label);});return oa.join(ea);};function na(oa){var pa=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],qa=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];'use strict';var ra=pa.type,sa=ra===undefined?'offer':ra,ta=pa.sdp,ua=ta===undefined?'':ta;this.$RTCSessionDescription1=oa;this.type=sa;if(oa===i.P2P){var va=[];if(this.type==='offer'){if(qa.DISABLE_VIDEO)va.push(function(ab){return c('FBRTCSdpUtils').disableVideo(ab);});va.push(function(ab){return c('FBRTCSdpUtils').addIceOptionToSdp(ab,'fb-force-5245');},function(ab){return c('FBRTCSdpUtils').replaceRTPSAVPFProfile(ab);},function(ab){return c('FBRTCSdpUtils').preferIsac(ab);},function(ab){return c('FBRTCSdpUtils').removeSdparta(ab);});if(qa.ADD_AUDIO_NACK)va.push(function(ab){return c('FBRTCSdpUtils').addAudioNack(ab);});}else va.push(function(ab){return c('FBRTCSdpUtils').addIceOptionToSdp(ab,'fb-force-5245');},function(ab){return c('FBRTCSdpUtils').useDTLSOverCrypto(ab);});this.$RTCSessionDescription2=va.reduce(function(ab,bb){return bb(ab);},ua);}else{var wa=ua.trim().split(ea),xa=0,ya=[];while(xa<wa.length&&!ha(wa[xa],m)){ya.push(wa[xa]);xa++;}this.sessionDescription=new la(ya);this.mediaDescriptions=[];while(xa<wa.length){var za=[];za.push(wa[xa]);xa++;while(xa<wa.length&&!ha(wa[xa],m)){za.push(wa[xa]);xa++;}this.mediaDescriptions.push(new ma(za,this.type,qa.FORMAT_PARAMETERS));}}}na.prototype.processServerMediaUpdate=function(oa){'use strict';var pa=oa.sourceKey,qa=oa.media,ra=oa.ssrcGroups,sa=[],ta=[];qa.forEach(function(ua){ua.ssrcs.forEach(function(va){var wa={ssrc:va,cname:pa,msid:{id:pa,appdata:ua.id},label:ua.id,mslabel:pa};if(h.AUDIO===ua.type){sa.push(wa);}else if(h.VIDEO===ua.type)ta.push(wa);});});this.mediaDescriptions.forEach(function(ua){if(ua.getMediaType()===fa){ua.addStreamsForEndpoint(pa,sa);ua.addSsrcGroupsForEndpoint(pa,ra);}else if(ua.getMediaType()===ga){ua.addStreamsForEndpoint(pa,ta);ua.addSsrcGroupsForEndpoint(pa,ra);}});};na.prototype.toDesc=function(){'use strict';return new j({type:this.type,sdp:this.toSdp()});};na.prototype.toSdp=function(){'use strict';var oa=this.$RTCSessionDescription1;switch(oa){case i.P2P:return this.$RTCSessionDescription2;case i.MULTIWAY:return this.sessionDescription.toSdp()+ea+this.mediaDescriptions.map(function(pa){return pa.toSdp();}).join(ea)+ea;default:throw new Error('Unknown signaling protocol '+oa);}};na.prototype.strongDiff=function(oa){'use strict';var pa=this.toSdp(),qa=oa.toSdp();return pa!==qa&&this.$RTCSessionDescription3(pa)!==this.$RTCSessionDescription3(qa);};na.prototype.$RTCSessionDescription3=function(oa){'use strict';return this.$RTCSessionDescription4(oa).split('\r\n').filter(function(pa){return !/^a=(candidate|setup):/.test(pa);}).join('\r\n');};na.prototype.$RTCSessionDescription4=function(oa){'use strict';return oa.replace(/(o=\S+\s\S+)\s\S+\s/,'$1 - ');};f.exports=na;}),null);
__d('FBRTCPeerConnection',['Promise','regeneratorRuntime','FBRTCSdpUtils','Map','RTCIceCandidate','RTCPeerConnection','RTCSessionDescription','UserAgent','FBRTCConstants'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').SignalingProtocol;function i(u){var v=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],w=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];this.$FBRTCPeerConnection3=[];this.$FBRTCPeerConnection4=[];this.$FBRTCPeerConnection7=new (c('Map'))();this.addEventListener=function(x,y){var z=this.$FBRTCPeerConnection7.get(x);if(!Array.isArray(z)){z=[];this.$FBRTCPeerConnection7.set(x,z);}z.push(y);this.$FBRTCPeerConnection5.addEventListener(x,y);};this.removeEventListener=function(x,y){var z=this.$FBRTCPeerConnection7.get(x);if(Array.isArray(z)){z=z.filter(function(aa){return aa!==y;});if(z.length<1){this.$FBRTCPeerConnection7['delete'](x);}else this.$FBRTCPeerConnection7.set(x,z);}this.$FBRTCPeerConnection5.removeEventListener(x,y);};this.$FBRTCPeerConnection9=function(x){var y=x.candidate;if(y)this.$FBRTCPeerConnection4.push(y);}.bind(this);this.$FBRTCPeerConnection10=function(x){var y=x.channel;this.$FBRTCPeerConnection11(y);}.bind(this);this.$FBRTCPeerConnection6=u;this.$FBRTCPeerConnection1=v;this.$FBRTCPeerConnection2=w;this.$FBRTCPeerConnection5=this.$FBRTCPeerConnection8();}i.prototype.$FBRTCPeerConnection8=function(){var u=new (c('RTCPeerConnection'))(this.$FBRTCPeerConnection1,this.$FBRTCPeerConnection2);u.addEventListener('icecandidate',this.$FBRTCPeerConnection9);u.addEventListener('datachannel',this.$FBRTCPeerConnection10);for(var v=this.$FBRTCPeerConnection7.entries(),w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y,aa=z[0],ba=z[1];for(var ca=ba,da=Array.isArray(ca),ea=0,ca=da?ca:ca[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fa;if(da){if(ea>=ca.length)break;fa=ca[ea++];}else{ea=ca.next();if(ea.done)break;fa=ea.value;}var ga=fa;u.addEventListener(aa,ga);}}return u;};i.prototype.reset=function(){var u=this.$FBRTCPeerConnection5;for(var v=this.$FBRTCPeerConnection7.entries(),w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y,aa=z[0],ba=z[1];for(var ca=ba,da=Array.isArray(ca),ea=0,ca=da?ca:ca[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fa;if(da){if(ea>=ca.length)break;fa=ca[ea++];}else{ea=ca.next();if(ea.done)break;fa=ea.value;}var ga=fa;u.removeEventListener(aa,ga);}}u.removeEventListener('datachannel',this.$FBRTCPeerConnection9);u.removeEventListener('icecandidate',this.$FBRTCPeerConnection9);this.$FBRTCPeerConnection3=[];this.$FBRTCPeerConnection4=[];this.$FBRTCPeerConnection5=this.$FBRTCPeerConnection8();for(var ha=u.getLocalStreams(),ia=Array.isArray(ha),ja=0,ha=ia?ha:ha[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ka;if(ia){if(ja>=ha.length)break;ka=ha[ja++];}else{ja=ha.next();if(ja.done)break;ka=ja.value;}var la=ka;this.addStream(la);}return c('Promise').race([new (c('Promise'))(function(ma){var na=this.$FBRTCPeerConnection5,oa=function pa(qa){var ra=qa.target;if(ra.iceConnectionState!=='checking'&&ra.iceConnectionState!=='new'){ma();na.removeEventListener('iceconnectionstatechange',pa);r(u);}};na.addEventListener('iceconnectionstatechange',oa);}.bind(this)),new (c('Promise'))(function(ma){return setTimeout(ma,5000);})])['catch'](function(ma){return c('Promise').resolve();}).then(function(){r(u);});};i.prototype.close=function(){r(this.$FBRTCPeerConnection5);};i.prototype.getCreatedIceCandidates=function(){return this.$FBRTCPeerConnection4;};i.prototype.$FBRTCPeerConnection11=function(u){u.addEventListener('close',function(){this.$FBRTCPeerConnection3=this.$FBRTCPeerConnection3.filter(function(v){return v!==u;});}.bind(this));this.$FBRTCPeerConnection3.push(u);};i.prototype.onReceivedRemoteIceCandidate=function(u){var v=u.sdp,w=u.label,x=u.sdp_mid,y=new (c('RTCIceCandidate'))({sdpMLineIndex:w,candidate:c('FBRTCSdpUtils').fixMobileIceSdp(v),sdpMid:x});this.$FBRTCPeerConnection5.addIceCandidate(y);};i.prototype.getLocalStreams=function(){return this.$FBRTCPeerConnection5.getLocalStreams();};i.prototype.getRemoteStreams=function(){return this.$FBRTCPeerConnection5.getRemoteStreams();};i.prototype.addStream=function(u){if(s('addTrack')){for(var v=u.getTracks(),w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;this.$FBRTCPeerConnection5.addTrack(z,u);}}else this.$FBRTCPeerConnection5.addStream(u);};i.prototype.removeStream=function(u){var v,w=this;if(s('removeTrack')&&s('getSenders')){(function(){var x=u.getTracks(),y=w.$FBRTCPeerConnection5.getSenders().filter(function(ea){return x.includes(ea.track);});for(var z=y,aa=Array.isArray(z),ba=0,z=aa?z:z[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ca;if(aa){if(ba>=z.length)break;ca=z[ba++];}else{ba=z.next();if(ba.done)break;ca=ba.value;}var da=ca;w.$FBRTCPeerConnection5.removeTrack(da);}})();}else this.$FBRTCPeerConnection5.removeStream(u);};i.prototype.createOffer=function u(){var v=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],w=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],x=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];return c('regeneratorRuntime').async(function y(z){while(1)switch(z.prev=z.next){case 0:return z.abrupt('return',k(this.$FBRTCPeerConnection5,v).then(function(aa){aa.sdp=x.audio?c('FBRTCSdpUtils').preferCodec(aa.sdp,x.audio,false):aa.sdp;aa.sdp=x.video?c('FBRTCSdpUtils').preferCodec(aa.sdp,x.video,true):aa.sdp;return new (c('RTCSessionDescription'))(this.$FBRTCPeerConnection6,aa,{FORMAT_PARAMETERS:w});}.bind(this)));case 1:case 'end':return z.stop();}},null,this);};i.prototype.createAnswer=function u(){return c('regeneratorRuntime').async(function v(w){while(1)switch(w.prev=w.next){case 0:return w.abrupt('return',l(this.$FBRTCPeerConnection5).then(function(x){return new (c('RTCSessionDescription'))(this.$FBRTCPeerConnection6,x);}.bind(this)));case 1:case 'end':return w.stop();}},null,this);};i.prototype.setLocalDescription=function u(v){return c('regeneratorRuntime').async(function w(x){while(1)switch(x.prev=x.next){case 0:return x.abrupt('return',p(this.$FBRTCPeerConnection5,v.toDesc()).then(function(){return v;}));case 1:case 'end':return x.stop();}},null,this);};i.prototype.setRemoteDescription=function u(v){return c('regeneratorRuntime').async(function w(x){while(1)switch(x.prev=x.next){case 0:return x.abrupt('return',q(this.$FBRTCPeerConnection5,v.toDesc()).then(function(){return v;}));case 1:case 'end':return x.stop();}},null,this);};i.prototype.getLocalDescription=function(){return new (c('RTCSessionDescription'))(this.$FBRTCPeerConnection6,this.$FBRTCPeerConnection5.localDescription);};i.prototype.getRemoteDescription=function(){return new (c('RTCSessionDescription'))(this.$FBRTCPeerConnection6,this.$FBRTCPeerConnection5.remoteDescription);};i.prototype.getSignalingState=function(){return this.$FBRTCPeerConnection5.signalingState;};i.prototype.getIceGatheringState=function(){return this.$FBRTCPeerConnection5.iceGatheringState;};i.prototype.getIceConnectionState=function(){return this.$FBRTCPeerConnection5.iceConnectionState;};i.prototype.getStats=function(){if(c('UserAgent').isBrowser('Firefox'))return c('Promise').resolve(this.$FBRTCPeerConnection5.getStats());if(c('UserAgent').isBrowser('Edge'))return c('Promise').resolve({});if(c('UserAgent').isBrowser('Chrome')||c('UserAgent').isBrowser('Opera'))return new (c('Promise'))(function(u,v){this.$FBRTCPeerConnection5.getStats(u,v);}.bind(this)).then(function(u){var v={};for(var w=u.result(),x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var z;if(x){if(y>=w.length)break;z=w[y++];}else{y=w.next();if(y.done)break;z=y.value;}var aa=z,ba={id:aa.id,timestamp:aa.timestamp,type:aa.type};for(var ca=aa.names(),da=Array.isArray(ca),ea=0,ca=da?ca:ca[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fa;if(da){if(ea>=ca.length)break;fa=ca[ea++];}else{ea=ca.next();if(ea.done)break;fa=ea.value;}var ga=fa;ba[ga]=aa.stat(ga);}v[ba.id]=ba;}return v;});return c('Promise').reject(new Error('getStats() not supported'));};i.prototype.createDataChannel=function(u,v){var w=this.$FBRTCPeerConnection5.createDataChannel(u,v);this.$FBRTCPeerConnection11(w);return w;};i.prototype.getDataChannelByLabel=function(u){return this.$FBRTCPeerConnection3.find(function(v){return v.label===u;});};var j=c('UserAgent').isBrowser('Chrome < 52')||c('UserAgent').isBrowser('Opera < 39')||c('UserAgent').isBrowser('Firefox < 37');function k(u,v){if(j)return new (c('Promise'))(function(w,x){return u.createOffer(w,x,n(v));});return u.createOffer(n(v));}function l(u){if(j)return new (c('Promise'))(function(v,w){return u.createAnswer(v,w);});return u.createAnswer();}var m=c('UserAgent').isBrowser('Chrome < 38')||c('UserAgent').isBrowser('Opera < 26');function n(u){var v=u.offerToReceiveAudio,w=v===undefined?true:v,x=u.offerToReceiveVideo,y=x===undefined?true:x,z=babelHelpers.objectWithoutProperties(u,['offerToReceiveAudio','offerToReceiveVideo']);if(m){if(Object.keys(z).length>0)return {mandatory:{OfferToReceiveAudio:w,OfferToReceiveVideo:y},optional:babelHelpers['extends']({},t(z))};return {mandatory:{OfferToReceiveAudio:w,OfferToReceiveVideo:y}};}return babelHelpers['extends']({offerToReceiveAudio:w,offerToReceiveVideo:y},z);}var o=c('UserAgent').isBrowser('Chrome < 51')||c('UserAgent').isBrowser('Opera < 38')||c('UserAgent').isBrowser('Firefox < 37');function p(u,v){if(o)return new (c('Promise'))(function(w,x){return u.setLocalDescription(v,w,x);});return u.setLocalDescription(v);}function q(u,v){if(o)return new (c('Promise'))(function(w,x){return u.setRemoteDescription(v,w,x);});return u.setRemoteDescription(v);}function r(u){if(u&&u.signalingState!=='closed')u.close();}function s(u){return u in c('RTCPeerConnection').prototype;}function t(u){var v={};for(var w=Object.keys(u),x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var z;if(x){if(y>=w.length)break;z=w[y++];}else{y=w.next();if(y.done)break;z=y.value;}var aa=z,ba=''+aa.substr(0,1).toUpperCase()+aa.substr(1);v[ba]=u[aa];}return v;}f.exports=i;}),null);
__d("XGroupCallSendRequestController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/sendrequest\/",{webrtc_fbtrace:{type:"Int"}});}),null);
__d('MultiwayRequests',['Promise','RTCSessionDescription','RTCUtils','XGroupCallSendRequestController','AsyncRequest','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=15000,i=c('MultiwayTypes').MessageType,j=c('MultiwayTypes').Capability;function k(){}k.prototype.sendJoinRequest=function(l,m,n,o,p,q){var r=c('RTCUtils').createRequestHeader(i.JOIN,m,n),s={offer:{sdpString:o.toSdp()},deviceCapabilities:[j.SUPPORT_AUDIO,j.SUPPORT_VIDEO]};if(p&&p.length>0)s.usersToCall=p;if(q)s.mediaStatus=q;var t={endpoint:l,jsonPayload:{header:r,body:{joinRequest:s}}};return this.$MultiwayRequests1(t);};k.prototype.sendHangupRequest=function(l,m,n,o,p){var q=c('RTCUtils').createRequestHeader(i.HANGUP,m,n),r={reason:o,detailedReasonString:p},s={endpoint:l,jsonPayload:{header:q,body:{hangupRequest:r}}};return this.$MultiwayRequests1(s);};k.prototype.sendAddParticipantsRequest=function(l,m,n,o){var p=c('RTCUtils').createRequestHeader(i.ADD_PARTICIPANTS,m,n),q={usersToInvite:o},r={endpoint:l,jsonPayload:{header:p,body:{addParticipantsRequest:q}}};return this.$MultiwayRequests1(r);};k.prototype.sendSubscriptionRequest=function(l,m,n,o){return this.$MultiwayRequests1({endpoint:l,jsonPayload:{header:c('RTCUtils').createRequestHeader(i.SUBSCRIPTION,m,n),body:{subscriptionRequest:{subscriptions:o}}}});};k.prototype.sendClientMediaUpdateRequest=function(l,m,n,o,p,q){return this.$MultiwayRequests1({endpoint:l,jsonPayload:{header:c('RTCUtils').createRequestHeader(i.CLIENT_MEDIA_UPDATE,m,n),body:{clientMediaUpdateRequest:{fromVersion:o,toVersion:p,mediaUpdates:q}}}});};k.prototype.$MultiwayRequests1=function(l){return new (c('Promise'))(function(m,n){var o=c('XGroupCallSendRequestController').getURIBuilder().getURI(),p=new (c('AsyncRequest'))(o).setMethod('POST').setData({request:JSON.stringify(l)}).setAllowCrossPageTransition(true).setHandler(function(q){m(q.payload);}).setErrorHandler(function(q){var r=Error(q.getErrorDescription?q.getErrorDescription():'AsyncRequest error');n(r);}).setTimeoutHandler(h,function(){n('Timeout');});p.send();});};f.exports=new k();}),null);
__d('RTCMWProtocolHandler',['regeneratorRuntime','Promise','FBRTCConstants','ChannelManager','CurrentUser','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCPeerConnection','MultiwayRequests','RTCCallActions','RTCCallStore','RTCConfig','MultiwayTypes','RTCGroupCallActions','RTCMultiwayMessageHandler','RTCSessionDescription','RTCUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').CallEndReason,i=c('FBRTCConstants').CallType,j=c('FBRTCConstants').IceConnectionState,k=c('FBRTCConstants').SignalingProtocol,l=c('MultiwayTypes').RtcResponseStatusCode,m='229895473858072',n=180000,o={appId:m,deviceId:c('ChannelManager').getCompleteConfig().sessionID,userId:c('CurrentUser').getID()};c('ChannelManager').startChannelManager();function p(){var r=arguments.length<=0||arguments[0]===undefined?null:arguments[0];this.$RTCMWProtocolHandler4=function(s){var t=s.target;c('RTCCallActions').emit('onIceConnectionStateChange',t.iceConnectionState);switch(t.iceConnectionState){case j.DISCONNECTED:case j.FAILED:if(!this.$RTCMWProtocolHandler2)this.$RTCMWProtocolHandler2=setTimeout(function(){c('RTCCallActions').endCall(h.CONNECTION_DROPPED,'ConnectionDropped');var u=c('RTCCallStore').getState(),v=u.connections;c('RTCMultiwayMessageHandler').close();v.forEach(function(w){return w.close();});c('RTCCallActions').removeAllLocalStreams(true);},n);break;default:clearTimeout(this.$RTCMWProtocolHandler2);this.$RTCMWProtocolHandler2=null;}}.bind(this);this.$RTCMWProtocolHandler1=r;}p.prototype.startCall=function(r,s,t,u){var v=u.callTrigger,w=u.formatParameters,x=w===undefined?{}:w,y=u.preferredCodecs,z=y===undefined?{}:y,aa=u.serverInfoData;c('RTCCallActions').initialize(k.MULTIWAY,t,aa,this.$RTCMWProtocolHandler1,v);var ba=c('FBRTCCallSummary').restoreOrInitialize(c('FBRTCCallSummaryStore').getInstance(),c('RTCUtils').isGroupCall(t)?-1:c('RTCUtils').getPeerID(t),this.$RTCMWProtocolHandler1,!aa);v&&ba.onCallStarted(v);ba.onPopupOpened();ba.setConferenceName(t);ba.setServerInfoData(aa);ba.save(c('FBRTCCallSummaryStore').getInstance());c('RTCCallActions').setCallSummary(ba);c('RTCGroupCallActions').setMWCallType(s.some(function(fa){return fa.getVideoTracks().length>0;})?i.DIRECT_VIDEO:i.VOIP);var ca={mandatory:{},optional:[{googNumUnsignalledRecvStreams:10},{googHighBitrate:true},{googVeryHighBitrate:true},{RtpDataChannels:true}]};if(!c('RTCConfig').RtcUseDtlsGK)ca.optional.push({DtlsSrtpKeyAgreement:false});var da=new (c('FBRTCPeerConnection'))(k.MULTIWAY,{iceServers:[]},ca),ea=da.createDataChannel('data');ea.onmessage=function(fa){var ga=fa.data;try{var ha=JSON.parse(ga),ia=ha.body;if(ia.dominantSpeakerNotification){var ja=ia.dominantSpeakerNotification.userId;c('RTCGroupCallActions').setDominantSpeaker(ja);}}catch(ka){}};da.addEventListener('addstream',function(event){event.stream.onaddtrack=function(fa){var ga=fa.target,ha=fa.track;c('RTCCallActions').addRemoteTrack(ga,ha);};event.stream.onremovetrack=function(fa){var ga=fa.target,ha=fa.track;c('RTCCallActions').removeRemoteTrack(ga,ha);};c('RTCCallActions').addRemoteStream(event.stream);this.$RTCMWProtocolHandler3(c('RTCCallStore').getState().callInfo.conferenceName,c('RTCCallStore').getState().callInfo.serverInfoData,c('RTCCallStore').getState().connections.first().getRemoteStreams().map(function(fa){var ga=fa.id;return {cname:ga};}));}.bind(this));da.addEventListener('removestream',function(event){c('RTCCallActions').removeRemoteStream(event.stream);});da.addEventListener('iceconnectionstatechange',this.$RTCMWProtocolHandler4);this.$RTCMWProtocolHandler5(da,s,t,aa,r,x,z);if(!aa){c('RTCCallActions').call(r,da);}else c('RTCCallActions').join(da);return da;};p.videoEscalation=function(){return c('RTCUtils').initLocalStream(true).then(function(r){var s=c('RTCCallStore').getState(),t=s.callInfo,u=t.conferenceName,v=t.serverInfoData,w=s.connections,x=s.localUser;r.getTracks().forEach(function(z){if(z.kind==='audio')z.enabled=!x.isAudioMuted();});var y=x.getStreams().first();w.first().removeStream(y);return q(w.first(),[r],u,v,[]).then(function(){c('RTCCallActions').removeLocalStream(y);c('RTCCallActions').addLocalStream(r);c('RTCGroupCallActions').setMWCallType(i.ESCALATED);});});};p.endCall=function(r,s,t){var u=arguments.length<=3||arguments[3]===undefined?'':arguments[3];c('RTCMultiwayMessageHandler').close();c('RTCCallActions').removeAllLocalStreams(true);c('RTCCallActions').hangup(t,u);c('MultiwayRequests').sendHangupRequest(o,r,s,t,u||'Hangup by user').done(c('RTCCallActions').hangupSuccess,c('RTCCallActions').hangupError);};p.prototype.iceRestart=function(r,s){q(c('RTCCallStore').getState().connections.first(),[],r,s,[],{iceRestart:true});};p.addParticipants=function(r,s,t){c('MultiwayRequests').sendAddParticipantsRequest(o,r,s,t);};p.prototype.$RTCMWProtocolHandler3=function(r,s,t){c('MultiwayRequests').sendSubscriptionRequest(o,r,s,t);};p.clientMediaUpdate=function(r,s,t,u,v){c('MultiwayRequests').sendClientMediaUpdateRequest(o,r,s,t,u,v).then(function(w){var x=w.header.responseStatusCode,y=w.body.clientMediaUpdateResponse.currentVersion;return c('RTCGroupCallActions').onClientMediaUpdateResponse(x,y);})['catch'](function(w){});};p.prototype.$RTCMWProtocolHandler5=function(r,s,t,u,v,w,x){this.$RTCMWProtocolHandler6(t,u);q(r,s,t,u,v,{},w,x).done(function(y){return c('RTCCallActions').callSuccess();},function(y){c('RTCCallActions').callError(y);var z=c('RTCCallStore').getState(),aa=z.connections;c('RTCMultiwayMessageHandler').close();aa.forEach(function(ba){return ba.close();});c('RTCCallActions').removeAllLocalStreams(true);});};p.prototype.$RTCMWProtocolHandler6=function(r,s){c('RTCMultiwayMessageHandler').initHandler(r,s);};function q(r,s,t,u,v){var w=arguments.length<=5||arguments[5]===undefined?{}:arguments[5],x=arguments.length<=6||arguments[6]===undefined?{}:arguments[6],y=arguments.length<=7||arguments[7]===undefined?{}:arguments[7],z,aa,ba,ca,da,ea;return c('regeneratorRuntime').async(function fa(ga){while(1)switch(ga.prev=ga.next){case 0:z={};aa=[];s.forEach(function(ha){aa.concat(ha.getTracks());r.addStream(ha);});aa.forEach(function(ha){z[ha.id]=true;});ga.next=6;return c('regeneratorRuntime').awrap(r.createOffer(w,x,y));case 6:ba=ga.sent;c('RTCGroupCallActions').onJoinRequestSent();ga.next=10;return c('regeneratorRuntime').awrap(c('MultiwayRequests').sendJoinRequest(o,t,u,ba,v.length>0?v:null,aa.length>0?z:null));case 10:ca=ga.sent;da=ca.header.responseStatusCode;if(!(da!==l.OK)){ga.next=14;break;}return ga.abrupt('return',new (c('Promise'))(function(ha,ia){ia(da);}));case 14:c('RTCGroupCallActions').onJoinResponse(ca.header.serverInfoData);ea=new (c('RTCSessionDescription'))(k.MULTIWAY,{type:'answer',sdp:ca.body.joinResponse.answer.sdpString},{FORMAT_PARAMETERS:x});ga.next=18;return c('regeneratorRuntime').awrap(r.setLocalDescription(ba));case 18:ga.next=20;return c('regeneratorRuntime').awrap(r.setRemoteDescription(ea));case 20:c('RTCGroupCallActions').toggleRemoteStream(ca.body.joinResponse.mediaStatus);return ga.abrupt('return',r);case 22:case 'end':return ga.stop();}},null,this);}f.exports=p;}),null);
__d('FBRTCGroupCallIncomingController',['FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConstants','FBRTCGroupCallIncomingDialog','FBRTCSupport','MessengerRTCGroupCallIncomingDialogController','MessengerRTCGroupCallUnsupportedBrowserDialogController','MultiwayTypes','RTCMWProtocolHandler','RTCUtils','FBRTCCallUIWrapper','FBRTCTransactions','RTCConfig','FBRTCMultiwayMessage'],(function a(b,c,d,e,f,g){var h,i,j=c('FBRTCTransactions').FBRTCTransactionOwner,k=c('FBRTCTransactions').FBRTCServerTransaction,l=c('MultiwayTypes').HangupReason,m=c('MultiwayTypes').Capability,n=c('MultiwayTypes').RtcResponseStatusCode,o=c('MultiwayTypes').DeviceStatus,p=c('MultiwayTypes').RingType;h=babelHelpers.inherits(q,j);i=h&&h.prototype;function q(r){'use strict';i.constructor.call(this);this.$FBRTCGroupCallIncomingController1=r;this.$FBRTCGroupCallIncomingController2=null;}q.prototype.onMessageReceived=function(r){'use strict';var s=new (c('FBRTCMultiwayMessage'))(r),t=this.getTransaction(s);t.start().then(function(u){if(u!=null)if(u.ringRequest()!=null){if(!c('RTCUtils').isGroupCall(u.conferenceName())&&!c('RTCConfig').RTCConferencingP2PCanReceiveGK)return;var v=c('RTCUtils').generateRandomInt(),w=new (c('FBRTCCallSummary'))({peerID:c('RTCUtils').isGroupCall(u.conferenceName())?-1:c('RTCUtils').getPeerID(u.conferenceName()),callID:v,isCaller:false});if(!c('FBRTCSupport').isGroupCallWebtrcSupported()){w.onCallEnded(c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION,false);w.save(c('FBRTCCallSummaryStore').getInstance());var x=u.ringRequest(),y=x.ringType;c('MessengerRTCGroupCallUnsupportedBrowserDialogController').render({hasVideo:c('RTCConfig').RtcConferencingVideoGK&&(y===p.GROUP_VIDEO_CALL||y===p.PEER_VIDEO_CALL)});return;}t.sendResponse(this.handleRingRequest(u,v,w));}else if(u.dismissRequest()!=null){t.sendResponse(this.handleDismissRequest(u));}}.bind(this),function(u){}).done();};q.prototype.cancelIncomingCallDialog=function(){'use strict';if(this.$FBRTCGroupCallIncomingController2){this.$FBRTCGroupCallIncomingController2.cancel();this.$FBRTCGroupCallIncomingController2=null;}};q.prototype.handleDismissRequest=function(r){'use strict';c('MessengerRTCGroupCallUnsupportedBrowserDialogController').unmount();if(this.$FBRTCGroupCallIncomingController2){var s=this.$FBRTCGroupCallIncomingController2.serverInfoData();if(s==r.serverInfoData()){this.cancelIncomingCallDialog();}}return r.createResponse(n.OK,{});};q.prototype.handleRingRequest=function(r,s,t){'use strict';var u=r.ringRequest(),v=r.serverInfoData();if(u==null||v==null)return r.createResponse(n.BAD_REQUEST);var w=u.caller,x=u.otherParticipants,y=c('RTCConfig').RtcConferencingVideoGK&&(u.ringType==p.GROUP_VIDEO_CALL||u.ringType==p.PEER_VIDEO_CALL),z=new this.$FBRTCGroupCallIncomingController1(r.conferenceName(),s,w,x,y,v);z.addListener('answerCall',function(ba,ca){c('FBRTCCallUIWrapper').openGroupCallURI(ba,s,y,v,'answer button',t);});z.addListener('ignoreCall',function(){c('RTCMWProtocolHandler').endCall(r.conferenceName(),v,l.IGNORE_CALL);t.onCallEnded(c('FBRTCConstants').CallEndReason.IGNORE_CALL,false);t.save(c('FBRTCCallSummaryStore').getInstance());this.cancelIncomingCallDialog();}.bind(this));z.addListener('timeout',function(){c('RTCMWProtocolHandler').endCall(r.conferenceName(),v,l.NO_ANSWER_TIMEOUT);t.onCallEnded(c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT,false);t.save(c('FBRTCCallSummaryStore').getInstance());this.cancelIncomingCallDialog();}.bind(this));this.$FBRTCGroupCallIncomingController2=z;z.showIncomingDialog();var aa={deviceCapabilities:[m.SUPPORT_AUDIO,m.SUPPORT_VIDEO],deviceStatus:o.OK};return r.createResponse(n.OK,{ringResponse:aa});};f.exports=q;}),null);