if (self.CavalryLogger) { CavalryLogger.start_js(["n+vi3"]); }

__d('RelayModernEnvironment',['RelayCore','RelayDefaultHandlerProvider','RelayPublishQueue','normalizeRelayPayload'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=i.handlerProvider?i.handlerProvider:c('RelayDefaultHandlerProvider');this.$RelayModernEnvironment1=i.network;this.$RelayModernEnvironment2=new (c('RelayPublishQueue'))(i.store,j);this.$RelayModernEnvironment3=i.store;this.unstable_internal=c('RelayCore');}h.prototype.getStore=function(){return this.$RelayModernEnvironment3;};h.prototype.applyUpdate=function(i){var j=function(){this.$RelayModernEnvironment2.revertUpdate(i);this.$RelayModernEnvironment2.run();}.bind(this);this.$RelayModernEnvironment2.applyUpdate(i);this.$RelayModernEnvironment2.run();return {dispose:j};};h.prototype.check=function(i){return this.$RelayModernEnvironment3.check(i);};h.prototype.commitPayload=function(i,j){var k=c('normalizeRelayPayload')(i,j);this.$RelayModernEnvironment2.commitPayload(i,k);this.$RelayModernEnvironment2.run();};h.prototype.commitUpdate=function(i){this.$RelayModernEnvironment2.commitUpdate(i);this.$RelayModernEnvironment2.run();};h.prototype.lookup=function(i){return this.$RelayModernEnvironment3.lookup(i);};h.prototype.subscribe=function(i,j){return this.$RelayModernEnvironment3.subscribe(i,j);};h.prototype.retain=function(i){return this.$RelayModernEnvironment3.retain(i);};h.prototype.sendQuery=function(i){var j=i.cacheConfig,k=i.onCompleted,l=i.onError,m=i.onNext,n=i.operation,o=false,p=function q(){o=true;};this.$RelayModernEnvironment1.request(n.node,n.variables,j).then(function(q){if(o)return;this.$RelayModernEnvironment2.commitPayload(n.fragment,q);this.$RelayModernEnvironment2.run();m&&m(q);k&&k();}.bind(this))['catch'](function(q){if(o)return;l&&l(q);});return {dispose:p};};h.prototype.streamQuery=function(i){var j=i.cacheConfig,k=i.onCompleted,l=i.onError,m=i.onNext,n=i.operation;return this.$RelayModernEnvironment1.requestStream(n.node,n.variables,j,{onCompleted:k,onError:l,onNext:function(o){this.$RelayModernEnvironment2.commitPayload(n.fragment,o);this.$RelayModernEnvironment2.run();m&&m(o);}.bind(this)});};h.prototype.sendMutation=function(i){var j=i.onCompleted,k=i.onError,l=i.operation,m=i.optimisticUpdater,n=i.updater,o=i.uploadables;if(m){this.$RelayModernEnvironment2.applyUpdate(m);this.$RelayModernEnvironment2.run();}var p=false,q=function(){if(m){this.$RelayModernEnvironment2.revertUpdate(m);this.$RelayModernEnvironment2.run();m=null;}p=true;}.bind(this);this.$RelayModernEnvironment1.request(l.node,l.variables,{force:true},o).then(function(r){if(p)return;if(m)this.$RelayModernEnvironment2.revertUpdate(m);this.$RelayModernEnvironment2.commitPayload(l.fragment,r,n);this.$RelayModernEnvironment2.run();j&&j(r.errors);}.bind(this))['catch'](function(r){if(p)return;if(m)this.$RelayModernEnvironment2.revertUpdate(m);this.$RelayModernEnvironment2.run();k&&k(r);}.bind(this));return {dispose:q};};h.prototype.sendSubscription=function(i){var j=i.onCompleted,k=i.onNext,l=i.onError,m=i.operation,n=i.updater;return this.$RelayModernEnvironment1.requestStream(m.node,m.variables,{force:true},{onCompleted:j,onError:l,onNext:function(o){this.$RelayModernEnvironment2.commitPayload(m.fragment,o,n);this.$RelayModernEnvironment2.run();k&&k(o);}.bind(this)});};h.prototype['@@RelayModernEnvironment']=true;f.exports=h;}),null);